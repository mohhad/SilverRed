function GameObject(){this.zOrder=0,this.x=0,this.y=0,this.startupGameObject=function(n,t,i){return this.zOrder=i,this.x=n,this.y=t,g_GameObjectManager.addGameObject(this),this},this.shutdownGameObject=function(){g_GameObjectManager.removeGameObject(this)}}function VisualGameObject(){this.image=null,this.draw=function(n,t,i,r){t.drawImage(this.image,this.x-i,this.y-r)},this.startupVisualGameObject=function(n,t,i,r){return this.startupGameObject(t,i,r),this.image=n,this},this.shutdownVisualGameObject=function(){this.shutdownGameObject()}}function RepeatingGameObject(){this.width=0,this.height=0,this.scrollFactor=1,this.startupRepeatingGameObject=function(n,t,i,r,u,f,e){return this.startupVisualGameObject(n,t,i,r),this.width=u,this.height=f,this.scrollFactor=e,this},this.shutdownstartupRepeatingGameObject=function(){this.shutdownVisualGameObject()},this.draw=function(n,t,i,r){for(var e=[0,0],f,u=0;u<this.height;u+=e[1])for(f=0;f<this.width;f+=e[0]){var s=[this.x+f,this.y+u],h=[this.width-f,this.height-u],o=[0,0];f==0&&(o[0]=i*this.scrollFactor),u==0&&(o[1]=r*this.scrollFactor),e=this.drawRepeat(t,s,h,o)}},this.drawRepeat=function(n,t,i,r){var s=Math.abs(r[0])%this.image.width,h=Math.abs(r[1])%this.image.height,u=r[0]<0?this.image.width-s:s,f=r[1]<0?this.image.height-h:h,e=i[0]<this.image.width-u?i[0]:this.image.width-u,o=i[1]<this.image.height-f?i[1]:this.image.height-f;return n.drawImage(this.image,u,f,e,o,t[0],t[1],e,o),[e,o]}}function AnimatedGameObject(){this.currentFrame=0,this.timeBetweenFrames=0,this.timeSinceLastFrame=0,this.frameWidth=0,this.startupAnimatedGameObject=function(n,t,i,r,u,f){if(u<=0)throw"framecount can not be <= 0";if(f<=0)throw"fps can not be <= 0";this.startupVisualGameObject(n,t,i,r),this.currentFrame=0,this.frameCount=u,this.timeBetweenFrames=1/f,this.timeSinceLastFrame=this.timeBetweenFrames,this.frameWidth=this.image.width/this.frameCount},this.draw=function(n,t,i,r){var u=this.frameWidth*this.currentFrame;t.drawImage(this.image,u,0,this.frameWidth,this.image.height,this.x-i,this.y-r,this.frameWidth,this.image.height),this.timeSinceLastFrame-=n,this.timeSinceLastFrame<=0&&(this.timeSinceLastFrame=this.timeBetweenFrames,++this.currentFrame,this.currentFrame%=this.frameCount)}}function ApplicationManager(){this.startupApplicationManager=function(){return this.runner=(new AnimatedGameObject).startupAnimatedGameObject(g_run,0,0,1,cTotalFrames,FPS),this}}function GameObjectManager(){this.gameObjects=[],this.lastFrame=(new Date).getTime(),this.xScroll=0,this.yScroll=0,this.applicationManager=null,this.canvas=null,this.context2D=null,this.backBuffer=null,this.backBufferContext2D=null,this.startupGameObjectManager=function(){return g_GameObjectManager=this,this.canvas=document.getElementById("canvas1"),this.context2D=this.canvas.getContext("2d"),this.backBuffer=document.createElement("canvas"),this.backBuffer.width=this.canvas.width,this.backBuffer.height=this.canvas.height,this.backBufferContext2D=this.backBuffer.getContext("2d"),this.applicationManager=(new ApplicationManager).startupApplicationManager(),setInterval(function(){g_GameObjectManager.draw()},SECONDS_BETWEEN_FRAMES),this},this.draw=function(){var n=(new Date).getTime(),t=(n-this.lastFrame)/1e3;this.lastFrame=n,this.backBufferContext2D.clearRect(0,0,this.backBuffer.width,this.backBuffer.height),this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height);for(x in this.gameObjects)this.gameObjects[x].update&&this.gameObjects[x].update(t,this.backBufferContext2D,this.xScroll,this.yScroll);for(x in this.gameObjects)this.gameObjects[x].draw&&this.gameObjects[x].draw(t,this.backBufferContext2D,this.xScroll,this.yScroll);this.context2D.drawImage(this.backBuffer,0,0)},this.addGameObject=function(n){this.gameObjects.push(n),this.gameObjects.sort(function(n,t){return n.zOrder-t.zOrder})},this.removeGameObject=function(n){this.gameObjects.removeObject(n)}}function initCanvas(){(new GameObjectManager).startupGameObjectManager()}VisualGameObject.prototype=new GameObject,RepeatingGameObject.prototype=new VisualGameObject,AnimatedGameObject.prototype=new VisualGameObject,Array.prototype.remove=function(n,t){var i=this.slice((t||n)+1||this.length);return this.length=n<0?this.length+n:n,this.push.apply(this,i)},Array.prototype.removeObject=function(n){for(var t=0;t<this.length;++t)if(this[t]===n){this.remove(t);break}};
