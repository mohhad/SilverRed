var fabric=fabric||{version:"1.3.7"},Cufon,JSON;typeof exports!="undefined"&&(exports.fabric=fabric),typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",Cufon=function(){function v(n){var t=this.face=n.face;this.glyphs=n.glyphs,this.w=n.w,this.baseSize=parseInt(t["units-per-em"],10),this.family=t["font-family"].toLowerCase(),this.weight=t["font-weight"],this.style=t["font-style"]||"normal",this.viewBox=function(){var i=t.bbox.split(/\s+/),n={minX:parseInt(i[0],10),minY:parseInt(i[1],10),maxX:parseInt(i[2],10),maxY:parseInt(i[3],10)};return n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},n}(),this.ascent=-parseInt(t.ascent,10),this.descent=-parseInt(t.descent,10),this.height=-this.ascent+this.descent}function y(){var n={},t={oblique:"italic",italic:"oblique"};this.add=function(t){(n[t.style]||(n[t.style]={}))[t.weight]=t},this.get=function(i,r){var f=n[i]||n[t[i]]||n.normal||n.italic||n.oblique,s,h,e,o,u;if(!f)return null;if(r={normal:400,bold:700}[r]||parseInt(r,10),f[r])return f[r];s={1:1,99:0}[r%100],h=[],s===undefined&&(s=r>400),r==500&&(r=400);for(u in f)u=parseInt(u,10),(!e||u<e)&&(e=u),(!o||u>o)&&(o=u),h.push(u);return r<e&&(r=e),r>o&&(r=o),h.sort(function(n,t){return(s?n>r&&t>r?n<t:n>t:n<r&&t<r?n>t:n<t)?-1:1}),f[h[0]]}}function p(){function f(n,t){return n.contains?n.contains(t):n.compareDocumentPosition(t)&16}function t(n){var t=n.relatedTarget;t&&!f(this,t)&&u(this)}function i(){u(this)}function u(t){setTimeout(function(){n.replace(t,a.get(t).options,!0)},10)}this.attach=function(n){n.onmouseenter===undefined?(r(n,"mouseover",t),r(n,"mouseout",t)):(r(n,"mouseenter",i),r(n,"mouseleave",i))}}function w(){function i(n){return n.cufid||(n.cufid=++t)}var n={},t=0;this.get=function(t){var r=i(t);return n[r]||(n[r]={})}}function b(n){var i={},r={};this.get=function(t){return i[t]!=undefined?i[t]:n[t]},this.getSize=function(n,i){return r[n]||(r[n]=new t.Size(this.get(n),i))},this.extend=function(n){for(var t in n)i[t]=n[t];return this}}function r(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,function(){return i.call(n,fabric.window.event)})}function k(n,t){var i=a.get(n);return i.options?n:(t.hover&&t.hoverables[n.nodeName.toLowerCase()]&&tt.attach(n),i.options=t,n)}function e(n){var t={};return function(i){return t.hasOwnProperty(i)||(t[i]=n.apply(null,arguments)),t[i]}}function d(n,r){var f,e,u,o;for(r||(r=t.getStyle(n)),f=t.quotedList(r.get("fontFamily").toLowerCase()),u=0,o=f.length;u<o;++u)if(e=f[u],i[e])return i[e].get(r.get("fontStyle"),r.get("fontWeight"));return null}function o(n){return fabric.document.getElementsByTagName(n)}function s(){for(var i={},t,n=0,r=arguments.length;n<r;++n)for(t in arguments[n])i[t]=arguments[n][t];return i}function g(n,i,r,f,e,o){var l=f.separate,s,c;if(l=="none")return u[f.engine].apply(null,arguments);var v=fabric.document.createDocumentFragment(),a,h=i.split(it[l]),y=l=="words";for(y&&nt&&(/^\s/.test(i)&&h.unshift(""),/\s$/.test(i)&&h.push("")),s=0,c=h.length;s<c;++s)a=u[f.engine](n,y?t.textAlign(h[s],r,s,c):h[s],r,f,e,o,s<c-1),a&&v.appendChild(a);return v}function l(n,i){for(var f,e,c,s,o,h,r=k(n,i).firstChild;r;r=c){if(c=r.nextSibling,s=!1,r.nodeType==1){if(!r.firstChild)continue;if(/cufon/.test(r.className))s=!0;else{arguments.callee(r,i);continue}}if(e||(e=t.getStyle(n).extend(i)),f||(f=d(n,e)),f){if(s){u[i.engine](f,null,e,i,r,n);continue}(o=r.data,typeof G_vmlCanvasManager!="undefined"&&(o=o.replace(/\r/g,"\n")),o!=="")&&(h=g(f,o,e,i,r,n),h?r.parentNode.replaceChild(h,r):r.parentNode.removeChild(r))}}}var n=function(){return n.replace.apply(null,arguments)},c=n.DOM={ready:function(){var t=!1,u={loaded:1,complete:1},i=[],n=function(){if(!t){t=!0;for(var n;n=i.shift();n());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",n,!1),fabric.window.addEventListener("pageshow",n,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){u[fabric.document.readyState]?n():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),n()}catch(t){setTimeout(arguments.callee,1)}}(),r(fabric.window,"load",n),function(r){arguments.length?t?r():i.push(r):n()}}()},t=n.CSS={Size:function(n,t){this.value=parseFloat(n),this.unit=String(n).match(/[a-z%]*$/)[0]||"px",this.convert=function(n){return n/t*this.value},this.convertFrom=function(n){return n/this.value*t},this.toString=function(){return this.value+this.unit}},getStyle:function(n){return new b(n.style)},quotedList:e(function(n){for(var i=[],r=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,t;t=r.exec(n);)i.push(t[3]||t[1]);return i}),ready:function(){var n=!1,t=[],r=function(){n=!0;for(var i;i=t.shift();i());},u=Object.prototype.propertyIsEnumerable?o("style"):{length:0},i=o("link");return c.ready(function(){for(var f=0,t,n=0,e=i.length;t=i[n],n<e;++n)t.disabled||t.rel.toLowerCase()!="stylesheet"||++f;fabric.document.styleSheets.length>=u.length+f?r():setTimeout(arguments.callee,10)}),function(i){n?i():t.push(i)}}(),supports:function(n,t){var i=fabric.document.createElement("span").style;return i[n]===undefined?!1:(i[n]=t,i[n]===t)},textAlign:function(n,t,i,r){return t.get("textAlign")=="right"?i>0&&(n=" "+n):i<r-1&&(n+=" "),n},textDecoration:function(n,t){var i,r,f,u;for(t||(t=this.getStyle(n)),i={underline:null,overline:null,"line-through":null},r=n;r.parentNode&&r.parentNode.nodeType==1;){f=!0;for(u in i)i[u]||(t.get("textDecoration").indexOf(u)!=-1&&(i[u]=t.get("color")),f=!1);if(f)break;t=this.getStyle(r=r.parentNode)}return i},textShadow:e(function(n){if(n=="none")return null;for(var r=[],t={},i,u=0,f=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;i=f.exec(n);)i[0]==","?(r.push(t),t={},u=0):i[1]?t.color=i[1]:t[["offX","offY","blur"][u++]]=i[2];return r.push(t),r}),color:e(function(n){var t={};return t.color=n.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(n,i,r){return t.opacity=parseFloat(r),"rgb("+i+")"}),t}),textTransform:function(n,t){return n[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[t.get("textTransform")]||"toString"]()}},nt=" ".split(/\s+/).length==0,a=new w,tt=new p,h=[],u={},i={},f={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(n){return jQuery(n)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(n){return $$(n)}||fabric.window.$&&function(n){return $(n)}||fabric.document.querySelectorAll&&function(n){return fabric.document.querySelectorAll(n)}||o,separate:"words",textShadow:"none"},it={words:/\s+/,characters:""};return n.now=function(){return c.ready(),n},n.refresh=function(){for(var i=h.splice(0,h.length),t=0,r=i.length;t<r;++t)n.replace.apply(null,i[t]);return n},n.registerEngine=function(t,i){return i?(u[t]=i,n.set("engine",t)):n},n.registerFont=function(t){var u=new v(t),r=u.family;return i[r]||(i[r]=new y),i[r].add(u),n.set("fontFamily",'"'+r+'"')},n.replace=function(i,r,u){return(r=s(f,r),!r.engine)?n:(typeof r.textShadow=="string"&&r.textShadow&&(r.textShadow=t.textShadow(r.textShadow)),u||h.push(arguments),(i.nodeType||typeof i=="string")&&(i=[i]),t.ready(function(){for(var u,t=0,f=i.length;t<f;++t)u=i[t],typeof u=="string"?n.replace(r.selector(u),r,!0):l(u,r)}),n)},n.replaceElement=function(n,i){return i=s(f,i),typeof i.textShadow=="string"&&i.textShadow&&(i.textShadow=t.textShadow(i.textShadow)),l(n,i)},n.engines=u,n.fonts=i,n.getOptions=function(){return s(f)},n.set=function(t,i){return f[t]=i,n},n}(),Cufon.registerEngine("canvas",function(){function u(n,t){var f=0,e=0,u=[],s=/([mrvxe])([^a-z]*)/g,o,r,i;n:for(r=0;o=s.exec(n);++r){i=o[2].split(",");switch(o[1]){case"v":u[r]={m:"bezierCurveTo",a:[f+~~i[0],e+~~i[1],f+~~i[2],e+~~i[3],f+=~~i[4],e+=~~i[5]]};break;case"r":u[r]={m:"lineTo",a:[f+=~~i[0],e+=~~i[1]]};break;case"m":u[r]={m:"moveTo",a:[f=~~i[0],e=~~i[1]]};break;case"x":u[r]={m:"closePath",a:[]};break;case"e":break n}t[u[r].m].apply(t,u[r].a)}return u}function f(n,t){for(var r,i=0,u=n.length;i<u;++i)r=n[i],t[r.m].apply(t,r.a)}var t=Cufon.CSS.supports("display","inline-block"),r=!t&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId)),n=fabric.document.createElement("style"),i;n.type="text/css",i=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(r?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(t?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{n.appendChild(i)}catch(e){n.setAttribute("type","text/css"),n.styleSheet.cssText=i.data}return fabric.document.getElementsByTagName("head")[0].appendChild(n),function(n,i,r,e,o){function ei(){var u,o,p,f;s.save();var r=0,t=0,i=[{left:0}];for(e.backgroundColor&&(s.save(),s.fillStyle=e.backgroundColor,s.translate(0,n.ascent),s.fillRect(0,0,a+10,(-n.ascent+n.descent)*it),s.restore()),e.textAlign==="right"?(s.translate(c[t],0),i[0].left=c[t]*l):e.textAlign==="center"&&(s.translate(c[t]/2,0),i[0].left=c[t]/2*l),u=0,o=y.length;u<o;++u){if(y[u]==="\n"){t++;var h=-n.ascent-n.ascent/5*e.lineHeight,w=i[i.length-1],v={left:0};w.width=r*l,w.height=(-n.ascent+n.descent)*l,e.textAlign==="right"?(s.translate(-a,h),s.translate(c[t],0),v.left=c[t]*l):e.textAlign==="center"?(s.translate(-r-c[t-1]/2,h),s.translate(c[t]/2,0),v.left=c[t]/2*l):s.translate(-r,h),i.push(v),r=0;continue}(p=n.glyphs[y[u]]||n.missingGlyph,p)&&(f=Number(p.w||n.w)+d,e.textBackgroundColor&&(s.save(),s.fillStyle=e.textBackgroundColor,s.translate(0,n.ascent),s.fillRect(0,0,f+10,-n.ascent+n.descent),s.restore()),s.translate(f,0),r+=f,u==o-1&&(i[i.length-1].width=r*l,i[i.length-1].height=(-n.ascent+n.descent)*l))}s.restore(),Cufon.textOptions.boundaries=i}function ri(t){var l,o,v,w,p,i,h;for(s.fillStyle=t||Cufon.textOptions.color||r.get("color"),l=0,o=0,e.textAlign==="right"?s.translate(c[o],0):e.textAlign==="center"&&s.translate(c[o]/2,0),v=0,w=y.length;v<w;++v){if(y[v]==="\n"){o++,p=-n.ascent-n.ascent/5*e.lineHeight,e.textAlign==="right"?(s.translate(-a,p),s.translate(c[o],0)):e.textAlign==="center"?(s.translate(-l-c[o-1]/2,p),s.translate(c[o]/2,0)):s.translate(-l,p),l=0;continue}(i=n.glyphs[y[v]]||n.missingGlyph,i)&&(h=Number(i.w||n.w)+d,rt&&(s.save(),s.strokeStyle=s.fillStyle,s.lineWidth+=s.lineWidth,s.beginPath(),rt.underline&&(s.moveTo(0,-n.face["underline-position"]+.5),s.lineTo(h,-n.face["underline-position"]+.5)),rt.overline&&(s.moveTo(0,n.ascent+.5),s.lineTo(h,n.ascent+.5)),rt["line-through"]&&(s.moveTo(0,-n.descent+.5),s.lineTo(h,-n.descent+.5)),s.stroke(),s.restore()),yt&&(s.save(),s.transform(1,0,-.25,1,0,0)),s.beginPath(),i.d&&(i.code?f(i.code,s):i.code=u("m"+i.d,s)),s.fill(),e.strokeStyle&&(s.closePath(),s.save(),s.lineWidth=e.strokeWidth,s.strokeStyle=e.strokeStyle,s.stroke(),s.restore()),yt&&s.restore(),s.translate(h,0),l+=h)}}var pt=i===null,g=n.viewBox,v=r.getSize("fontSize",n.baseSize),d=r.get("letterSpacing"),lt,c,w,b,ot,s,l,ii,rt,yt,h,p,tt;d=d=="normal"?0:v.convertFrom(parseInt(d,10));var ut=0,wt=0,ft=0,k=e.textShadow,nt=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,k)for(Cufon.textOptions.shadows=k,h=0,p=k.length;h<p;++h){var tt=k[h],ui=v.convertFrom(parseFloat(tt.offX)),fi=v.convertFrom(parseFloat(tt.offY));nt[h]=[ui,fi]}var y=Cufon.CSS.textTransform(pt?o.alt:i,r).split(""),a=0,ht=null,ct=0,it=1,et=[];for(h=0,p=y.length;h<p;++h){if(y[h]==="\n"){it++,a>ct&&(ct=a),et.push(a),a=0;continue}(lt=n.glyphs[y[h]]||n.missingGlyph,lt)&&(a+=ht=Number(lt.w||n.w)+d)}for(et.push(a),a=Math.max(ct,a),c=[],h=et.length;h--;)c[h]=a-et[h];if(ht===null)return null;wt+=g.width-ht,ft+=g.minX,pt?(w=o,b=o.firstChild):(w=fabric.document.createElement("span"),w.className="cufon cufon-canvas",w.alt=i,b=fabric.document.createElement("canvas"),w.appendChild(b),e.printable&&(ot=fabric.document.createElement("span"),ot.className="cufon-alt",ot.appendChild(fabric.document.createTextNode(i)),w.appendChild(ot)));var st=w.style,bt=b.style||{},kt=v.convert(g.height-ut+0),at=Math.ceil(kt),dt=at/kt;b.width=Math.ceil(v.convert(a+wt-ft)*dt),b.height=at,ut+=g.minY,bt.top=Math.round(v.convert(ut-n.ascent))+"px",bt.left=Math.round(v.convert(ft))+"px";var gt=Math.ceil(v.convert(a*dt)),ni=gt+"px",vt=v.convert(n.height),ti=(e.lineHeight-1)*v.convert(-n.ascent/5)*(it-1);for(Cufon.textOptions.width=gt,Cufon.textOptions.height=vt*it+ti,Cufon.textOptions.lines=it,Cufon.textOptions.totalLineHeight=ti,t?(st.width=ni,st.height=vt+"px"):(st.paddingLeft=ni,st.paddingBottom=vt-1+"px"),s=Cufon.textOptions.context||b.getContext("2d"),l=at/g.height,Cufon.textOptions.fontAscent=n.ascent*l,Cufon.textOptions.boundaries=null,ii=Cufon.textOptions.shadowOffsets,h=nt.length;h--;)ii[h]=[nt[h][0]*l,nt[h][1]*l];if(s.save(),s.scale(l,l),s.translate(-ft-1/l*b.width/2+(Cufon.fonts[n.family].offsetLeft||0),-ut-Cufon.textOptions.height/l/2+(Cufon.fonts[n.family].offsetTop||0)),s.lineWidth=n.face["underline-thickness"],s.save(),rt=Cufon.getTextDecoration(e),yt=e.fontStyle==="italic",s.save(),ei(),k)for(h=0,p=k.length;h<p;++h)tt=k[h],s.save(),s.translate.apply(s,nt[h]),ri(tt.color),s.restore();return ri(),s.restore(),s.restore(),s.restore(),w}}()),Cufon.registerEngine("vml",function(){function r(n,t){return i(n,/(?:em|ex|%)$/i.test(t)?"1em":t)}function i(n,t){var i,r,u;return/px$/i.test(t)?parseFloat(t):(i=n.style.left,r=n.runtimeStyle.left,n.runtimeStyle.left=n.currentStyle.left,n.style.left=t,u=n.style.pixelLeft,n.style.left=i,n.runtimeStyle.left=r,u)}var n,t;if(fabric.document.namespaces)return(n=fabric.document.createElement("canvas"),n&&n.getContext&&n.getContext.apply)?void 0:(fabric.document.namespaces.cvml==null&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),t=fabric.document.createElement("cvml:shape"),t.style.behavior="url(#default#VML)",!t.coordsize)?void 0:(t=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}<\/style>'),function(n,t,u,f,e,o,s){var nt=t===null,c,p,k,st;nt&&(t=e.alt);var b=n.viewBox,v=u.computedFontSize||(u.computedFontSize=new Cufon.CSS.Size(r(o,u.get("fontSize"))+"px",n.baseSize)),y=u.computedLSpacing;y==undefined&&(y=u.get("letterSpacing"),u.computedLSpacing=y=y=="normal"?0:~~v.convertFrom(i(o,y))),nt?(c=e,p=e.firstChild):(c=fabric.document.createElement("span"),c.className="cufon cufon-vml",c.alt=t,p=fabric.document.createElement("span"),p.className="cufon-vml-canvas",c.appendChild(p),f.printable&&(k=fabric.document.createElement("span"),k.className="cufon-alt",k.appendChild(fabric.document.createTextNode(t)),c.appendChild(k)),s||c.appendChild(fabric.document.createElement("cvml:shape")));var ct=c.style,tt=p.style,lt=v.convert(b.height),it=Math.ceil(lt),at=it/lt,rt=b.minX,vt=b.minY;tt.height=it,tt.top=Math.round(v.convert(vt-n.ascent)),tt.left=Math.round(v.convert(rt)),ct.height=v.convert(n.height)+"px";for(var ui=Cufon.getTextDecoration(f),ni=u.get("color"),ut=Cufon.CSS.textTransform(t,u).split(""),ft=0,yt=0,et=null,l,h,ot=f.textShadow,w=0,pt=0,wt=ut.length;w<wt;++w)l=n.glyphs[ut[w]]||n.missingGlyph,l&&(ft+=et=~~(l.w||n.w)+y);if(et===null)return null;var bt=-rt+ft+(b.width-et),ti=v.convert(bt*at),ii=Math.round(ti),kt=bt+","+b.height,dt,ri="r"+kt+"nsnf";for(w=0;w<wt;++w)if(l=n.glyphs[ut[w]]||n.missingGlyph,l){if(nt?(h=p.childNodes[pt],h.firstChild&&h.removeChild(h.firstChild)):(h=fabric.document.createElement("cvml:shape"),p.appendChild(h)),h.stroked="f",h.coordsize=kt,h.coordorigin=dt=rt-yt+","+vt,h.path=(l.d?"m"+l.d+"xe":"")+"m"+dt+ri,h.fillcolor=ni,st=h.style,st.width=ii,st.height=it,ot){var ht=ot[0],d=ot[1],gt=Cufon.CSS.color(ht.color),g,a=fabric.document.createElement("cvml:shadow");a.on="t",a.color=gt.color,a.offset=ht.offX+","+ht.offY,d&&(g=Cufon.CSS.color(d.color),a.type="double",a.color2=g.color,a.offset2=d.offX+","+d.offY),a.opacity=gt.opacity||g&&g.opacity||1,h.appendChild(a)}yt+=~~(l.w||n.w)+y,++pt}return ct.width=Math.max(Math.ceil(v.convert(ft*at)),0),c})}()),Cufon.getTextDecoration=function(n){return{underline:n.textDecoration==="underline",overline:n.textDecoration==="overline","line-through":n.textDecoration==="line-through"}},typeof exports!="undefined"&&(exports.Cufon=Cufon),JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var s,l,h,a,v=n,c,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i)),typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,c=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,s=0;s<a;s+=1)c[s]=u(s,e)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));else for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(n,t){var r,u,i=n[t];if(i&&typeof i=="object")for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(u=walk(i,r),u!==undefined?i[r]=u:delete i[r]);return reviver.call(n,t,i)}var j;if(text=String(text),f.lastIndex=0,f.test(text)&&(text=text.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse");})}(),fabric.log=function(){},fabric.warn=function(){},typeof console!="undefined"&&(typeof console.log!="undefined"&&console.log.apply&&(fabric.log=function(){return console.log.apply(console,arguments)}),typeof console.warn!="undefined"&&console.warn.apply&&(fabric.warn=function(){return console.warn.apply(console,arguments)})),function(){function n(n,t){this.__eventListeners[n]&&(t?fabric.util.removeFromArray(this.__eventListeners[n],t):this.__eventListeners[n].length=0)}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(this.__eventListeners){if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}}function r(n,t){var i,r,u;if(this.__eventListeners&&(i=this.__eventListeners[n],i)){for(r=0,u=i.length;r<u;r++)i[r].call(this,t||{});return this}}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var n=arguments.length;n--;)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(n,t,i){var r=this.getObjects();return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded(n),this.renderOnAddRemove&&this.renderAll(),this},remove:function(n){var t=this.getObjects(),i=t.indexOf(n);return i!==-1&&(t.splice(i,1),this._onObjectRemoved(n)),this.renderOnAddRemove&&this.renderAll(),n},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},item:function(n){return this.getObjects()[n]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(n){return this.getObjects().indexOf(n)>-1},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)}},function(n){function h(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n}function c(n,t){return Math.floor(Math.random()*(t-n+1))+n}function l(n){return n*r}function a(n){return n/r}function v(n,t,i){var r=Math.sin(i),u=Math.cos(i),f,e;return n.subtractEquals(t),f=n.x*u-n.y*r,e=n.x*r+n.y*u,new fabric.Point(f,e).addEquals(t)}function y(n,t){return parseFloat(Number(n).toFixed(t))}function p(){return!1}function w(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),f(t)[n]}function f(t){var i;if(!t)return fabric;var u=t.split("."),f=u.length,r=n||fabric.window;for(i=0;i<f;++i)r=r[u[i]];return r}function b(n,t,i){if(n){var r=fabric.util.createImage();r.onload=function(){t&&t.call(i,r),r=r.onload=null},r.src=n}else t&&t.call(i,n)}function k(n,t,i,r){function f(){++e===o&&t&&t(u)}var u=[],e=0,o=n.length;n.forEach(function(n,t){if(!n||!n.type){f();return}var e=fabric.util.getKlass(n.type,i);e.async?e.fromObject(n,function(i,e){e||(u[t]=i,r&&r(n,u[t])),f()}):(u[t]=e.fromObject(n),r&&r(n,u[t]),f())})}function d(n,t,i){var r;return r=n.length>1?new fabric.PathGroup(n,t):n[0],typeof i!="undefined"&&r.setSourcePath(i),r}function g(n,t,i){if(i&&Object.prototype.toString.call(i)==="[object Array]")for(var r=0,u=i.length;r<u;r++)i[r]in n&&(t[i[r]]=n[i[r]])}function nt(n,t,i,r,u,f){var e=r-t,h=u-i,c=o(e*e+h*h),a=s(h,e),v=f.length,y=0,l=!0;for(n.save(),n.translate(t,i),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=f[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()}function tt(n){return n||(n=fabric.document.createElement("canvas")),n.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(n),n}function it(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")}function rt(n){for(var t=n.prototype,r=t.stateProperties.length;r--;){var i=t.stateProperties[r],u=i.charAt(0).toUpperCase()+i.slice(1),f="set"+u,e="get"+u;t[e]||(t[e]=function(n){return new Function('return this.get("'+n+'")')}(i)),t[f]||(t[f]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(i))}}function ut(n,t){t.save(),t.beginPath(),n.clipTo(t),t.clip()}function ft(n,t){for(var o=[[n[0],n[2],n[4]],[n[1],n[3],n[5]],[0,0,1]],s=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],i=[],u,e,f,r=0;r<3;r++)for(i[r]=[],u=0;u<3;u++){for(e=0,f=0;f<3;f++)e+=o[r][f]*s[f][u];i[r][u]=e}return[i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]]}function et(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]}function ot(n,t,i,r){for(var o=r[0],s=r[1],h=r[2],c=r[3],l=r[4],a=r[5],v=r[6],f=st(a,v,o,s,c,l,h,t,i),e,u=0;u<f.length;u++)e=ht.apply(this,f[u]),n.bezierCurveTo.apply(n,e)}function st(n,i,r,f,o,s,h,c,l){var nt,tt,it,v,yt,pt;if(t=e.call(arguments),u[t])return u[t];var ot=h*(Math.PI/180),y=Math.sin(ot),p=Math.cos(ot);r=Math.abs(r),f=Math.abs(f);var st=p*(c-n)*.5+y*(l-i)*.5,ht=p*(l-i)*.5-y*(c-n)*.5,w=st*st/(r*r)+ht*ht/(f*f);w>1&&(w=Math.sqrt(w),r*=w,f*=w);var ct=p/r,lt=y/r,at=-y/f,vt=p/f,b=ct*c+lt*l,k=at*c+vt*l,d=ct*n+lt*i,g=at*n+vt*i,wt=(d-b)*(d-b)+(g-k)*(g-k),rt=1/wt-.25;rt<0&&(rt=0),nt=Math.sqrt(rt),s===o&&(nt=-nt);var ut=.5*(b+d)-nt*(g-k),ft=.5*(k+g)+nt*(d-b),et=Math.atan2(k-ft,b-ut),bt=Math.atan2(g-ft,d-ut),a=bt-et;for(a<0&&s===1?a+=2*Math.PI:a>0&&s===0&&(a-=2*Math.PI),tt=Math.ceil(Math.abs(a/(Math.PI*.5+.001))),it=[],v=0;v<tt;v++)yt=et+v*a/tt,pt=et+(v+1)*a/tt,it[v]=[ut,ft,yt,pt,r,f,y,p];return u[t]=it,it}function ht(n,r,u,f,o,s,h,c){if(t=e.call(arguments),i[t])return i[t];var a=c*o,v=-h*s,y=h*o,p=c*s,w=.5*(f-u),l=8/3*Math.sin(w*.5)*Math.sin(w*.5)/Math.sin(w),d=n+Math.cos(u)-l*Math.sin(u),g=r+Math.sin(u)+l*Math.cos(u),b=n+Math.cos(f),k=r+Math.sin(f),nt=b+l*Math.sin(f),tt=k-l*Math.cos(f);return i[t]=[a*d+v*g,y*d+p*g,a*nt+v*tt,y*nt+p*tt,a*b+v*k,y*b+p*k],i[t]}var o=Math.sqrt,s=Math.atan2,r;fabric.util={},r=Math.PI/180;var u={},i={},e=Array.prototype.join,t;fabric.util.removeFromArray=h,fabric.util.degreesToRadians=l,fabric.util.radiansToDegrees=a,fabric.util.rotatePoint=v,fabric.util.toFixed=y,fabric.util.getRandomInt=c,fabric.util.falseFunction=p,fabric.util.getKlass=w,fabric.util.resolveNamespace=f,fabric.util.loadImage=b,fabric.util.enlivenObjects=k,fabric.util.groupSVGElements=d,fabric.util.populateWithProperties=g,fabric.util.drawDashedLine=nt,fabric.util.createCanvasElement=tt,fabric.util.createImage=it,fabric.util.createAccessors=rt,fabric.util.clipContext=ut,fabric.util.multiplyTransformMatrices=ft,fabric.util.getFunctionBody=et,fabric.util.drawArc=ot}(typeof exports!="undefined"?exports:this),function(){function t(t,i){for(var u=n.call(arguments,2),f=[],r=0,e=t.length;r<e;r++)f[r]=u.length?t[r][i].apply(t[r],u):t[r][i].call(t[r]);return f}function i(n,t){if(!n||n.length===0)return undefined;var i=n.length-1,r=t?n[i][t]:n[i];if(t)while(i--)n[i][t]>=r&&(r=n[i][t]);else while(i--)n[i]>=r&&(r=n[i]);return r}function r(n,t){if(!n||n.length===0)return undefined;var i=n.length-1,r=t?n[i][t]:n[i];if(t)while(i--)n[i][t]<r&&(r=n[i][t]);else while(i--)n[i]<r&&(r=n[i]);return r}var n=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r}),Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u}),Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i}),fabric.util.array={invoke:t,min:r,max:i}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function t(){}function f(t){var i=this.constructor.superclass.prototype[t];return arguments.length>1?i.apply(this,n.call(arguments,1)):i.call(this)}function e(){function r(){this.initialize.apply(this,arguments)}var e=null,o=n.call(arguments,0),s,h;for(typeof o[0]=="function"&&(e=o.shift()),r.superclass=e,r.subclasses=[],e&&(t.prototype=e.prototype,r.prototype=new t,e.subclasses.push(r)),s=0,h=o.length;s<h;s++)u(r,o[s],e);return r.prototype.initialize||(r.prototype.initialize=i),r.prototype.constructor=r,r.prototype.callSuper=f,r}var n=Array.prototype.slice,i=function(){},r=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),u=function(n,t,i){for(var u in t)n.prototype[u]=u in n.prototype&&typeof n.prototype[u]=="function"&&(t[u]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,n!=="initialize"?r:void 0}}(u):t[u],r&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=e}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function c(n,t){return{handler:t,wrappedHandler:l(n,t)}}function l(n,t){return function(i){t.call(s(n),i||fabric.window.event)}}function a(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function p(n,t){n||(n=fabric.window.event);for(var i=n.target||(typeof n.srcElement!="unknown"?n.srcElement:null),f=fabric.document.body||{scrollLeft:0,scrollTop:0},s=fabric.document.documentElement,c=i,r=0,u=0,h;i&&i.parentNode&&!h;)i=i.parentNode,i!==fabric.document&&fabric.util.getElementStyle(i,"position")==="fixed"&&(h=i),i!==fabric.document&&c!==t&&fabric.util.getElementStyle(i,"position")==="absolute"?(r=0,u=0):i===fabric.document?(r=f.scrollLeft||s.scrollLeft||0,u=f.scrollTop||s.scrollTop||0):(r+=i.scrollLeft||0,u+=i.scrollTop||0);return{x:e(n)+r,y:o(n)+u}}var r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),s,h,e,o;(function(){var n={};s=function(t){return n[t]},h=function(t,i){n[t]=i}})();var v=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),y=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;v?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):y?(u=function(n,i,u){var f=r(n),e;h(f,n),t[f]||(t[f]={}),t[f][i]||(t[f][i]=[]),e=c(f,u),t[f][i].push(e),n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={}),n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=a(f,i)),n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)}),fabric.util.addListener=u,fabric.util.removeListener=f,e=function(n){return typeof n.clientX!="unknown"?n.clientX:0},o=function(n){return typeof n.clientY!="unknown"?n.clientY:0},fabric.isTouchSupported&&(e=function(n){return n.type!=="touchend"?n.touches&&n.touches[0]?n.touches[0].pageX-(n.touches[0].pageX-n.touches[0].clientX)||n.clientX:n.clientX:n.changedTouches&&n.changedTouches[0]?n.changedTouches[0].pageX-(n.changedTouches[0].pageX-n.changedTouches[0].clientX)||n.clientX:n.clientX},o=function(n){return n.type!=="touchend"?n.touches&&n.touches[0]?n.touches[0].pageY-(n.touches[0].pageY-n.touches[0].clientY)||n.clientY:n.clientY:n.changedTouches&&n.changedTouches[0]?n.changedTouches[0].pageY-(n.changedTouches[0].pageY-n.changedTouches[0].clientY)||n.clientY:n.clientY}),fabric.util.getPointer=p,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u=typeof t.style.opacity=="string",f=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+t*100+")",n}),fabric.util.setStyle=r}(),function(){function f(n){return typeof n=="string"?fabric.document.getElementById(n):n}function i(n,t){var r=fabric.document.createElement(n),i;for(i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function e(n,t){(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function o(n,t,r){return typeof t=="string"&&(t=i(t,r)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function s(n){var i,u,f={left:0,top:0},t=n&&n.ownerDocument,e={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},o;if(!t)return{left:0,top:0};for(o in s)e[s[o]]+=parseInt(r(n,o),10)||0;return i=t.documentElement,typeof n.getBoundingClientRect!="undefined"&&(f=n.getBoundingClientRect()),u=t!=null&&t===t.window?t:t.nodeType===9&&(t.defaultView||t.parentWindow),{left:f.left+(u.pageXOffset||i.scrollLeft)-(i.clientLeft||0)+e.left,top:f.top+(u.pageYOffset||i.scrollTop)-(i.clientTop||0)+e.top}}function r(n,t){if(n.style||(n.style={}),fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(n,null)[t];var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i}var u=Array.prototype.slice,n=function(n){return u.call(n,0)},t;try{t=n(fabric.document.childNodes)instanceof Array}catch(h){}t||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i}),function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i,fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1,t(n||fabric.window.event),i=i.onload=i.onreadystatechange=null}},i.src=n,u.appendChild(i)}fabric.util.getScript=n}(),fabric.util.getById=f,fabric.util.toArray=n,fabric.util.makeElement=i,fabric.util.addClass=e,fabric.util.wrapElement=o,fabric.util.getElementOffset=s,fabric.util.getElementStyle=r}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function i(){}function r(r,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=t(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=i)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(r=n(r,u.parameters))),f.open(e,r,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],i,n=t.length;n--;)try{if(i=t[n](),i)return t[n]}catch(r){}}();fabric.util.request=r}(),function(){function t(t){t||(t={});var u=+new Date,r=t.duration||500,f=u+r,i,o=t.onChange||function(){},s=t.abort||function(){return!1},h=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},e="startValue"in t?t.startValue:0,c="endValue"in t?t.endValue:100,l=t.byValue||c-e;t.onStart&&t.onStart(),function a(){i=+new Date;var c=i>f?r:i-u;if(s()){t.onComplete&&t.onComplete();return}if(o(h(c,e,l,r)),i>f){t.onComplete&&t.onComplete();return}n(a)}()}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)},n=function(){return i.apply(fabric.window,arguments)};fabric.util.animate=t,fabric.util.requestAnimFrame=n}(),function(){function i(n,t,i,r){return i*(n/=r)*n+t}function r(n,t,i,r){return-i*(n/=r)*(n-2)+t}function u(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t}function f(n,t,i,r){return i*(n/=r)*n*n+t}function e(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function o(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function s(n,t,i,r){return i*(n/=r)*n*n*n+t}function h(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function c(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function l(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function a(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function v(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function y(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function p(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function w(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function b(n,t,i,r){return n===0?t:i*Math.pow(2,10*(n/r-1))+t}function k(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function d(n,t,i,r){return n===0?t:n===r?t+i:(n/=r/2,n<1)?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t}function g(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function nt(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function tt(n,t,i,r){return(n/=r/2,n<1)?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function it(n,t,i,r){var e=1.70158,u=0,f=i;return n===0?t:(n/=r,n===1)?t+i:(u||(u=r*.3),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),-(f*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u))+t)}function rt(n,t,i,r){var e=1.70158,u=0,f=i;return n===0?t:(n/=r,n===1)?t+i:(u||(u=r*.3),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),f*Math.pow(2,-10*n)*Math.sin((n*r-e)*2*Math.PI/u)+i+t)}function ut(n,t,i,r){var e=1.70158,u=0,f=i;return n===0?t:(n/=r/2,n===2)?t+i:(u||(u=r*.3*1.5),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),n<1)?-.5*f*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u)+t:f*Math.pow(2,-10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u)*.5+i+t}function ft(n,t,i,r,u){return u===undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function et(n,t,i,r,u){return u===undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ot(n,t,i,r,u){return(u===undefined&&(u=1.70158),n/=r/2,n<1)?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function t(t,i,r,u){return r-n(u-t,0,r,u)+i}function n(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function st(i,r,u,f){return i<f/2?t(i*2,0,u,f)*.5+r:n(i*2-f,0,u,f)*.5+u*.5+r}fabric.util.ease={easeInQuad:i,easeOutQuad:r,easeInOutQuad:u,easeInCubic:f,easeOutCubic:e,easeInOutCubic:o,easeInQuart:s,easeOutQuart:h,easeInOutQuart:c,easeInQuint:l,easeOutQuint:a,easeInOutQuint:v,easeInSine:y,easeOutSine:p,easeInOutSine:w,easeInExpo:b,easeOutExpo:k,easeInOutExpo:d,easeInCirc:g,easeOutCirc:nt,easeInOutCirc:tt,easeInElastic:it,easeOutElastic:rt,easeInOutElastic:ut,easeInBack:ft,easeOutBack:et,easeInOutBack:ot,easeInBounce:t,easeOutBounce:n,easeInOutBounce:st}}(),function(n){"use strict";function e(n){return n in f?f[n]:n}function o(n,i,r){var u,f;return(n==="fill"||n==="stroke")&&i==="none"?i="":n==="fillRule"?i=i==="evenodd"?"destination-over":i:n==="strokeDashArray"?i=i.replace(/,/g," ").split(/\s+/):n==="transformMatrix"&&(i=r&&r.transformMatrix?v(r.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i)),u=Object.prototype.toString.call(i)==="[object Array]",f=u?i.map(parseFloat):parseFloat(i),!u&&isNaN(f)?i:f}function y(n){var r,u;for(r in i)n[r]&&typeof n[i[r]]!="undefined"&&n[r].indexOf("url(")!==0&&(u=new t.Color(n[r]),n[r]=u.setAlpha(a(u.getAlpha()*n[i[r]],2)).toRgba(),delete n[i[r]]);return n}function p(n,i){var u,f,s;if(n)return f={},n.parentNode&&/^g$/i.test(n.parentNode.nodeName)&&(f=t.parseAttributes(n.parentNode,i)),s=i.reduce(function(t,i){return u=n.getAttribute(i),u&&(i=e(i),u=o(i,u,f),t[i]=u),t},{}),s=r(s,r(g(n),t.parseStyleAttribute(n))),y(r(f,s))}function w(n){var f,i,t,r,u;if(!n)return null;if(n=n.trim(),f=n.indexOf(",")>-1,n=n.split(/\s+/),i=[],f)for(t=0,r=n.length;t<r;t++)u=n[t].split(","),i.push({x:parseFloat(u[0]),y:parseFloat(u[1])});else for(t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i.length%2!=0,i}function h(n,t){var i=n.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(i){var f=i[1],r=i[3],e=i[4],u=i[5],o=i[6];f&&(t.fontStyle=f),r&&(t.fontSize=isNaN(parseFloat(r))?r:parseFloat(r)),e&&(t.fontSize=parseFloat(e)),o&&(t.fontFamily=o),u&&(t.lineHeight=u==="normal"?1:u)}}function b(n){var i={},r=n.getAttribute("style"),t,u,f;if(!r)return i;if(typeof r=="string")r.replace(/;$/,"").split(";").forEach(function(n){var r=n.split(":");t=e(r[0].trim().toLowerCase()),u=o(t,r[1].trim()),t==="font"?h(u,i):i[t]=u});else for(f in r)typeof r[f]!="undefined"&&(t=e(f.toLowerCase()),u=o(t,r[f]),t==="font"?h(u,i):i[t]=u);return i}function k(n){for(var r,u,i=n.length;i--;)r=n[i].get("fill"),/^url\(/.test(r)&&(u=r.slice(5,r.length-1),t.gradientDefs[u]&&n[i].set("fill",t.Gradient.fromElement(t.gradientDefs[u],n[i])))}function d(n,i,r,u){function c(){--v==0&&(f=f.filter(function(n){return n!=null}),k(f),i(f))}for(var f=new Array(n.length),v=n.length,o,h,l,e=0,a=n.length;e<a;e++)if(o=n[e],h=t[s(o.tagName)],h&&h.fromElement)try{h.async?h.fromElement(o,function(n,t){return function(i){u&&u(t,i),f.splice(n,0,i),c()}}(e,o),r):(l=h.fromElement(o,r),u&&u(o,l),f.splice(e,0,l),c())}catch(y){t.log(y)}else c()}function c(n){for(var f=n.getElementsByTagName("style"),t={},i,r,u=0,e=f.length;u<e;u++)r=f[0].textContent,r=r.replace(/\/\*[\s\S]*?\*\//g,""),i=r.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(n){return n.trim()}),i.forEach(function(n){var u=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),f,r,i,e;for(n=u[1],f=u[2].trim(),r=f.replace(/;$/,"").split(/\s*;\s*/),t[n]||(t[n]={}),i=0,e=r.length;i<e;i++){var o=r[i].split(/\s*:\s*/),s=o[0],h=o[1];t[n][s]=h}});return t}function g(n){var s=n.nodeName,u=n.getAttribute("class"),f=n.getAttribute("id"),e={},i,o,r;for(i in t.cssRules)if(o=u&&new RegExp("^\\."+u).test(i)||f&&new RegExp("^#"+f).test(i)||new RegExp("^"+s).test(i),o)for(r in t.cssRules[i])e[r]=t.cssRules[i][r];return e}function nt(n,i,r){function f(f){var e=f.responseXML;(!e.documentElement&&t.window.ActiveXObject&&f.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(f.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e.documentElement)&&t.parseSVGDocument(e.documentElement,function(r,f){u.set(n,{objects:t.util.array.invoke(r,"toObject"),options:f}),i(r,f)},r)}n=n.replace(/^\n\s*/,"").trim(),u.has(n,function(r){r?u.get(n,function(n){var t=tt(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:f})})}function tt(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[s(n.type)].fromObject(n)}),{objects:i,options:r}}function it(n,i,r){var u,f;n=n.trim(),typeof DOMParser!="undefined"?(f=new DOMParser,f&&f.parseFromString&&(u=f.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),t.parseSVGDocument(u.documentElement,function(n,t){i(n,t)},r)}function rt(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=['<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>"].join("")),i}function ut(n){var t="";return n.backgroundColor&&n.backgroundColor.source&&(t=['<pattern x="0" y="0" id="backgroundColorPattern" ','width="',n.backgroundColor.source.width,'" height="',n.backgroundColor.source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',n.backgroundColor.source.width,'" height="',n.backgroundColor.source.height,'" xlink:href="',n.backgroundColor.source.src,'"><\/image><\/pattern>'].join("")),t}function ft(n){for(var u=n.getElementsByTagName("linearGradient"),f=n.getElementsByTagName("radialGradient"),t,r={},i=u.length;i--;)t=u[i],r[t.getAttribute("id")]=t;for(i=f.length;i--;)t=f[i],r[t.getAttribute("id")]=t;return r}var t=n.fabric||(n.fabric={}),r=t.util.object.extend,s=t.util.string.capitalize,l=t.util.object.clone,a=t.util.toFixed,v=t.util.multiplyTransformMatrices,f,i,u;t.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],f={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},i={stroke:"strokeOpacity",fill:"fillOpacity"},t.parseTransformAttribute=function(){function f(n,t){var i=t[0];n[0]=Math.cos(i),n[1]=Math.sin(i),n[2]=-Math.sin(i),n[3]=Math.cos(i)}function e(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i,n[3]=r}function o(n,t){n[2]=t[0]}function s(n,t){n[1]=t[0]}function h(n,t){n[4]=t[0],t.length===2&&(n[5]=t[1])}var u=[1,0,0,1,0,0],n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",i="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",a="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",v="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+p+"|"+y+"|"+v+"|"+a+"|"+c+"|"+l+")",w="(?:"+r+"(?:"+i+r+")*)",b="^\\s*(?:"+w+"?)\\s*$",k=new RegExp(b),d=new RegExp(r,"g");return function(n){var i=u.concat(),c=[],l;if(!n||n&&!k.test(n))return i;for(n.replace(d,function(n){var l=new RegExp(r).exec(n).filter(function(n){return n!==""&&n!=null}),a=l[1],t=l.slice(2).map(parseFloat);switch(a){case"translate":h(i,t);break;case"rotate":f(i,t);break;case"scale":e(i,t);break;case"skewX":o(i,t);break;case"skewY":s(i,t);break;case"matrix":i=t}c.push(i.concat()),i=u.concat()}),l=c[0];c.length>1;)c.shift(),l=t.util.multiplyTransformMatrices(l,c[0]);return l}}(),t.parseSVGDocument=function(){function u(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName))return!0;return!1}var i=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",r=new RegExp("^\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*$");return function(n,f,e){var b,o,p,h,k,a,w;if(n){if(b=new Date,o=t.util.toArray(n.getElementsByTagName("*")),o.length===0){for(o=n.selectNodes("//*[name(.)!='svg']"),p=[],h=0,k=o.length;h<k;h++)p[h]=o[h];o=p}if(a=o.filter(function(n){return i.test(n.tagName)&&!u(n,/^(?:pattern|defs)$/)}),a&&(!a||a.length)){var s=n.getAttribute("viewBox"),d=n.getAttribute("width"),g=n.getAttribute("height"),v=null,y=null,nt,tt;s&&(s=s.match(r))&&(nt=parseInt(s[1],10),tt=parseInt(s[2],10),v=parseInt(s[3],10),y=parseInt(s[4],10)),v=d?parseFloat(d):v,y=g?parseFloat(g):y,w={width:v,height:y},t.gradientDefs=t.getGradientDefs(n),t.cssRules=c(n),t.parseElements(a,function(n){t.documentParsingTime=new Date-b,f&&f(n,w)},l(w),e)}}}}(),u={has:function(n,t){t(!1)},get:function(){},set:function(){}},r(t,{parseAttributes:p,parseElements:d,parseStyleAttribute:b,parsePointsAttribute:w,getCSSRules:c,loadSVGFromURL:nt,loadSVGFromString:it,createSVGFontFacesMarkup:rt,createSVGRefElementsMarkup:ut,getGradientDefs:ft})}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n,t){this.x=n,this.y=t}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t,t.prototype={constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return new t(this.x+(n.x-this.x)/2,this.y+(n.y-this.y)/2)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n,this.y=t},setFromPoint:function(n){this.x=n.x,this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x,this.y=n.y,n.x=t,n.y=i}}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){this.status=n,this.points=[]}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t,i.Intersection.prototype={appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}},i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!==0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=c===0||l===0?new t("Coincident"):new t("Parallel"),e},i.Intersection.intersectLinePolygon=function(n,i,r){for(var f=new t,e=r.length,u=0;u<e;u++){var o=r[u],s=r[(u+1)%e],h=t.intersectLineLine(n,i,o,s);f.appendPoints(h.points)}return f.points.length>0&&(f.status="Intersection"),f},i.Intersection.intersectPolygonPolygon=function(n,i){for(var u=new t,f=n.length,r=0;r<f;r++){var e=n[r],o=n[(r+1)%f],s=t.intersectLinePolygon(e,o,i);u.appendPoints(s.points)}return u.points.length>0&&(u.status="Intersection"),u},i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t,i.Color.prototype={_tryParsingColor:function(n){var i;n in t.colorNameMap&&(n=t.colorNameMap[n]),i=t.sourceFromHex(n),i||(i=t.sourceFromRgb(n)),i||(i=t.sourceFromHsl(n)),i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e,s=h>.5?o/(2-u-e):o/(u+e);switch(u){case n:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(f*360),Math.round(s*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var r=this.getSource(),i=r[0].toString(16),n,t;return i=i.length===1?"0"+i:i,n=r[1].toString(16),n=n.length===1?"0"+n:n,t=r[2].toString(16),t=t.length===1?"0"+t:t,i.toUpperCase()+n.toUpperCase()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}},i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,i.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))},i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}},i.Color.fromRgba=t.fromRgb,i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))},i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1),h,c,l;return e===0?h=c=l=u:(f=u<=.5?u*(e+1):u+e-u*e,o=u*2-f,h=r(o,f,s+1/3),c=r(o,f,s),l=r(o,f,s-1/3)),[Math.round(h*255),Math.round(c*255),Math.round(l*255),i[4]?parseFloat(i[4]):1]}},i.Color.fromHsla=t.fromHsl,i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))},i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}},i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:this),function(){function t(n){var e=n.getAttribute("style"),u=n.getAttribute("offset"),t,r,i,f;if(u=parseFloat(u)/(/%$/.test(u)?100:1),e)for(i=e.split(/\s*;\s*/),i[i.length-1]===""&&i.pop(),f=i.length;f--;){var o=i[f].split(/\s*:\s*/),s=o[0].trim(),h=o[1].trim();s==="stop-color"?t=h:s==="stop-opacity"&&(r=h)}return t||(t=n.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=n.getAttribute("stop-opacity")),t=new fabric.Color(t).toRgb(),{offset:u,color:t,opacity:isNaN(parseFloat(r))?1:parseFloat(r)}}function n(n,t){var i,r;for(i in t)typeof t[i]=="string"&&/^\d+%$/.test(t[i])&&(r=parseFloat(t[i],10),i==="x1"||i==="x2"||i==="r2"?t[i]=fabric.util.toFixed(n.width*r/100,2):(i==="y1"||i==="y2")&&(t[i]=fabric.util.toFixed(n.height*r/100,2))),i==="x1"||i==="x2"?t[i]-=fabric.util.toFixed(n.width/2,2):(i==="y1"||i==="y2")&&(t[i]-=fabric.util.toFixed(n.height/2,2))}function i(n,t){for(var i in t)i==="x1"||i==="x2"?t[i]+=fabric.util.toFixed(n.width/2,2):(i==="y1"||i==="y2")&&(t[i]+=fabric.util.toFixed(n.height/2,2)),i==="x1"||i==="x2"||i==="r2"?t[i]=fabric.util.toFixed(t[i]/n.width*100,2)+"%":(i==="y1"||i==="y2")&&(t[i]=fabric.util.toFixed(t[i]/n.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({initialize:function(n){n||(n={});var t={};this.id=fabric.Object.__uid++,this.type=n.type||"linear",t={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0},this.type==="radial"&&(t.r1=n.coords.r1||0,t.r2=n.coords.r2||0),this.coords=t,this.gradientUnits=n.gradientUnits||"objectBoundingBox",this.colorStops=n.colorStops.slice()},addColorStop:function(n){var t,i;for(t in n)i=new fabric.Color(n[t]),this.colorStops.push({offset:t,color:i.toRgb(),opacity:i.getAlpha()});return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(n,t){var r=fabric.util.object.clone(this.coords),f,u;for(this.colorStops.sort(function(n,t){return n.offset-t.offset}),t&&this.gradientUnits==="userSpaceOnUse"?(r.x1+=n.width/2,r.y1+=n.height/2,r.x2+=n.width/2,r.y2+=n.height/2):this.gradientUnits==="objectBoundingBox"&&i(n,r),this.type==="linear"?f=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',r.x1,'" y1="',r.y1,'" x2="',r.x2,'" y2="',r.y2,'">']:this.type==="radial"&&(f=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',r.x2,'" cy="',r.y2,'" r="',r.r2,'" fx="',r.x1,'" fy="',r.y1,'">']),u=0;u<this.colorStops.length;u++)f.push("<stop ",'offset="',this.colorStops[u].offset*100+"%",'" style="stop-color:',this.colorStops[u].color,this.colorStops[u].opacity?";stop-opacity: "+this.colorStops[u].opacity:";",'"/>');return f.push(this.type==="linear"?"<\/linearGradient>":"<\/radialGradient>"),f.join("")},toLive:function(n){var i,t,u;if(this.type){for(this.type==="linear"?i=n.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):this.type==="radial"&&(i=n.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)),t=0,u=this.colorStops.length;t<u;t++){var r=this.colorStops[t].color,f=this.colorStops[t].opacity,e=this.colorStops[t].offset;typeof f!="undefined"&&(r=new fabric.Color(r).setAlpha(f).toRgba()),i.addColorStop(parseFloat(e),r)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,r){var o=i.getElementsByTagName("stop"),f=i.nodeName==="linearGradient"?"linear":"radial",h=i.getAttribute("gradientUnits")||"objectBoundingBox",s=[],u={},e;for(f==="linear"?u={x1:i.getAttribute("x1")||0,y1:i.getAttribute("y1")||0,x2:i.getAttribute("x2")||"100%",y2:i.getAttribute("y2")||0}:f==="radial"&&(u={x1:i.getAttribute("fx")||i.getAttribute("cx")||"50%",y1:i.getAttribute("fy")||i.getAttribute("cy")||"50%",r1:0,x2:i.getAttribute("cx")||"50%",y2:i.getAttribute("cy")||"50%",r2:i.getAttribute("r")||"50%"}),e=o.length;e--;)s.push(t(o[e]));return n(r,u),new fabric.Gradient({type:f,coords:u,gradientUnits:h,colorStops:s})},forObject:function(t,i){return i||(i={}),n(t,i),new fabric.Gradient(i)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(n){if(n||(n={}),this.id=fabric.Object.__uid++,n.source)if(typeof n.source=="string")if(typeof fabric.util.getFunctionBody(n.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(n.source));else{var t=this;this.source=fabric.util.createImage(),fabric.util.loadImage(n.source,function(n){t.source=n})}else this.source=n.source;n.repeat&&(this.repeat=n.repeat),n.offsetX&&(this.offsetX=n.offsetX),n.offsetY&&(this.offsetY=n.offsetY)},toObject:function(){var n;return typeof this.source=="function"?n=String(this.source):typeof this.source.src=="string"&&(n=this.source.src),{source:n,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=typeof this.source=="function"?this.source():this.source,r=t.width/n.getWidth(),u=t.height/n.getHeight(),i="";return t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+r+'" height="'+u+'"><image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"><\/image><\/pattern>'},toLive:function(n){var t=typeof this.source=="function"?this.source():this.source;return n.createPattern(t,this.repeat)}}),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,initialize:function(n){typeof n=="string"&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var t="SourceAlpha";return n&&(n.fill===this.color||n.stroke===this.color)&&(t="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+t+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"><\/feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"><\/feOffset><feMerge><feMergeNode><\/feMergeNode><feMergeNode in="SourceGraphic"><\/feMergeNode><\/feMerge><\/filter>'},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var i=fabric.util.object.extend,u=fabric.util.getElementOffset,n=fabric.util.removeFromArray,t=fabric.util.removeListener,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(n,t){t||(t={}),this._initStatic(n,t),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:!0,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(n,t){this._objects=[],this._createLowerCanvas(n),this._initOptions(t),t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this)),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this)),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=u(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return fabric.util.loadImage(n,function(n){this.overlayImage=n,i&&"overlayImageLeft"in i&&(this.overlayImageLeft=i.overlayImageLeft),i&&"overlayImageTop"in i&&(this.overlayImageTop=i.overlayImageTop),t&&t()},this),this},setBackgroundImage:function(n,t,i){return fabric.util.loadImage(n,function(n){this.backgroundImage=n,i&&"backgroundImageOpacity"in i&&(this.backgroundImageOpacity=i.backgroundImageOpacity),i&&"backgroundImageStretch"in i&&(this.backgroundImageStretch=i.backgroundImageStretch),t&&t()},this),this},setBackgroundColor:function(n,t){if(n.source){var i=this;fabric.util.loadImage(n.source,function(r){i.backgroundColor=new fabric.Pattern({source:r,repeat:n.repeat}),t&&t()})}else this.backgroundColor=n,t&&t();return this},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw r;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(fabric.util.createCanvasElement(n),typeof n.getContext=="undefined")throw r;},_initOptions:function(n){for(var t in n)this[t]=n[t];(this.width=parseInt(this.lowerCanvasEl.width,10)||0,this.height=parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style)&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n){return this._setDimension("width",n)},setHeight:function(n){return this._setDimension("height",n)},setDimensions:function(n){for(var t in n)this._setDimension(t,n[t]);return this},_setDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.lowerCanvasEl.style[n]=t+"px",this.upperCanvasEl&&(this.upperCanvasEl[n]=t,this.upperCanvasEl.style[n]=t+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t+"px"),this[n]=t,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){if(t)if(this.controlsAboveOverlay){var i=t.hasBorders,r=t.hasControls;t.hasBorders=t.hasControls=!1,t.render(n),t.hasBorders=i,t.hasControls=r}else t.render(n)},_onObjectAdded:function(n){this.stateful&&n.setupState(),n.setCoords(),n.canvas=this,this.fire("object:added",{target:n}),n.fire("added")},_onObjectRemoved:function(n){this.fire("object:removed",{target:n}),n.fire("removed")},getObjects:function(){return this._objects},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i,r,f,u;for(this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),n||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this.backgroundColor&&(t.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(t):this.backgroundColor,t.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),typeof this.backgroundImage=="object"&&this._drawBackroundImage(t),i=this.getActiveGroup(),r=0,f=this._objects.length;r<f;++r)(!i||i&&this._objects[r]&&!i.contains(this._objects[r]))&&this._draw(t,this._objects[r]);return i&&(u=[],this.forEachObject(function(n){i.contains(n)&&u.push(n)}),i._set("objects",u),this._draw(t,i)),this.clipTo&&t.restore(),this.overlayImage&&t.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_drawBackroundImage:function(n){n.save(),n.globalAlpha=this.backgroundImageOpacity,this.backgroundImageStretch?n.drawImage(this.backgroundImage,0,0,this.width,this.height):n.drawImage(this.backgroundImage,0,0),n.restore()},renderTop:function(){var n=this.contextTop||this.contextContainer,t;return this.clearContext(n),this.selection&&this._groupSelector&&this._drawSelection(),t=this.getActiveGroup(),t&&t.render(n),this.overlayImage&&n.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return n.set("left",this.getCenter().left),this.renderAll(),this},centerObjectV:function(n){return n.set("top",this.getCenter().top),this.renderAll(),this},centerObject:function(n){return this.centerObjectH(n).centerObjectV(n)},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(n,t){var r=this.getActiveGroup(),i;return r&&this.discardActiveGroup(),i={objects:this.getObjects().map(function(i){var r,u;return this.includeDefaultValues||(r=i.includeDefaultValues,i.includeDefaultValues=!1),u=i[n](t),this.includeDefaultValues||(i.includeDefaultValues=r),u},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor},this.backgroundImage&&(i.backgroundImage=this.backgroundImage.src,i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch),this.overlayImage&&(i.overlayImage=this.overlayImage.src,i.overlayImageLeft=this.overlayImageLeft,i.overlayImageTop=this.overlayImageTop),fabric.util.populateWithProperties(this,i,t),r&&(this.setActiveGroup(new fabric.Group(r.getObjects())),r.forEachObject(function(n){n.set("active",!0)})),i},toSVG:function(n,t){var i,r;n||(n={}),i=[],n.suppressPreamble||i.push('<?xml version="1.0" encoding="',n.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'),i.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n.viewBox?n.viewBox.width:this.width,'" ','height="',n.viewBox?n.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,n.viewBox?'viewBox="'+n.viewBox.x+" "+n.viewBox.y+" "+n.viewBox.width+" "+n.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"<\/defs>"),this.backgroundColor&&this.backgroundColor.source&&i.push('<rect x="0" y="0" ','width="',this.backgroundColor.repeat==="repeat-y"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.width:this.width,'" height="',this.backgroundColor.repeat==="repeat-x"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',"><\/rect>"),this.backgroundImage&&i.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"><\/image>'),this.overlayImage&&i.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"><\/image>'),r=this.getActiveGroup(),r&&this.discardActiveGroup();for(var u=0,f=this.getObjects(),e=f.length;u<e;u++)i.push(f[u].toSVG(t));return r&&(this.setActiveGroup(new fabric.Group(r.getObjects())),r.forEachObject(function(n){n.set("active",!0)})),i.push("<\/svg>"),i.join("")},remove:function(n){return this.getActiveObject()===n&&(this.fire("before:selection:cleared",{target:n}),this.discardActiveObject(),this.fire("selection:cleared")),fabric.Collection.remove.call(this,n)},sendToBack:function(t){return n(this._objects,t),this._objects.unshift(t),this.renderAll&&this.renderAll()},bringToFront:function(t){return n(this._objects,t),this._objects.push(t),this.renderAll&&this.renderAll()},sendBackwards:function(t,i){var u=this._objects.indexOf(t),f,r,e;if(u!==0){if(i){for(f=u,r=u-1;r>=0;--r)if(e=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t),e){f=r;break}}else f=u-1;n(this._objects,t),this._objects.splice(f,0,t),this.renderAll&&this.renderAll()}return this},bringForward:function(t,i){var u=this._objects.indexOf(t),f,r,e;if(u!==this._objects.length-1){if(i){for(f=u,r=u+1;r<this._objects.length;++r)if(e=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t),e){f=r;break}}else f=u+1;n(this._objects,t),this._objects.splice(f,0,t),this.renderAll&&this.renderAll()}return this},moveTo:function(t,i){return n(this._objects,t),this._objects.splice(i,0,t),this.renderAll&&this.renderAll()},dispose:function(){return(this.clear(),!this.interactive)?this:(fabric.isTouchSupported?(t(this.upperCanvasEl,"touchstart",this._onMouseDown),t(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"remove"in Event&&Event.remove(this.upperCanvasEl,"gesture",this._onGesture)):(t(this.upperCanvasEl,"mousedown",this._onMouseDown),t(this.upperCanvasEl,"mousemove",this._onMouseMove),t(fabric.window,"resize",this._onResize)),this)},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),i(fabric.StaticCanvas.prototype,fabric.Observable),i(fabric.StaticCanvas.prototype,fabric.Collection),i(fabric.StaticCanvas.prototype,fabric.DataURLExporter),i(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=fabric.util.createCanvasElement(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(n){return this.shadow=new fabric.Shadow(n),this},_setBrushStyles:function(){var n=this.canvas.contextTop;n.strokeStyle=this.color,n.lineWidth=this.width,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var n=this.canvas.contextTop;n.shadowColor=this.shadow.color,n.shadowBlur=this.shadow.blur,n.shadowOffsetX=this.shadow.offsetX,n.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0}}),function(){var n=fabric.util.array.min,t=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(n){this.canvas=n,this._points=[]},onMouseDown:function(n){this._prepareForDrawing(n),this._captureDrawingPath(n),this._render()},onMouseMove:function(n){this._captureDrawingPath(n),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(n){var t=new fabric.Point(n.x,n.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(n){this._points.push(n)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(n){var t=new fabric.Point(n.x,n.y);this._addPoint(t)},_render:function(){var i=this.canvas.contextTop,n,t,r,f,u;for(i.beginPath(),n=this._points[0],t=this._points[1],this._points.length===2&&n.x===t.x&&n.y===t.y&&(n.x-=.5,t.x+=.5),i.moveTo(n.x,n.y),r=1,f=this._points.length;r<f;r++)u=n.midPointFrom(t),i.quadraticCurveTo(n.x,n.y,u.x,u.y),n=this._points[r],t=this._points[r+1];i.lineTo(n.x,n.y),i.stroke()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(i){for(var r=[],u=[],f=i[0],h=i[1],s=f,o,e=1,c=i.length;e<c;e++)o=f.midPointFrom(h),r.push(s.x),r.push(o.x),u.push(s.y),u.push(o.y),f=i[e],h=i[e+1],s=o;return r.push(f.x),u.push(f.y),{minx:n(r),miny:n(u),maxx:t(r),maxy:t(u)}},convertPointsToSVGPath:function(n,t,i,r){var e=[],f=new fabric.Point(n[0].x-t,n[0].y-r),s=new fabric.Point(n[1].x-t,n[1].y-r),u,h,o;for(e.push("M ",n[0].x-t," ",n[0].y-r," "),u=1,h=n.length;u<h;u++)o=f.midPointFrom(s),e.push("Q ",f.x," ",f.y," ",o.x," ",o.y," "),f=new fabric.Point(n[u].x-t,n[u].y-r),u+1<n.length&&(s=new fabric.Point(n[u+1].x-t,n[u+1].y-r));return e.push("L ",f.x," ",f.y," "),e},createPath:function(n){var t=new fabric.Path(n);return t.fill=null,t.stroke=this.color,t.strokeWidth=this.width,t.strokeLineCap=this.strokeLineCap,t.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var u=this.canvas.contextTop,t,i,r,n;if(u.closePath(),t=this._getSVGPathData().join(""),t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}i=this.box.minx+(this.box.maxx-this.box.minx)/2,r=this.box.miny+(this.box.maxy-this.box.miny)/2,this.canvas.contextTop.arc(i,r,3,0,Math.PI*2,!1),n=this.createPath(t),n.set({left:i,top:r}),this.canvas.add(n),n.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:n})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(n){this.canvas=n,this.points=[]},drawDot:function(n){var i=this.addPoint(n),t=this.canvas.contextTop;t.fillStyle=i.fill,t.beginPath(),t.arc(i.x,i.y,i.radius,0,Math.PI*2,!1),t.closePath(),t.fill()},onMouseDown:function(n){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(n)},onMouseMove:function(n){this.drawDot(n)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,i,t,f,n,r,u;for(this.canvas.renderOnAddRemove=!1,i=[],t=0,f=this.points.length;t<f;t++)n=this.points[t],r=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,fill:n.fill}),this.shadow&&r.setShadow(this.shadow),i.push(r);u=new fabric.Group(i),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},addPoint:function(n){var t=new fabric.Point(n.x,n.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=r,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n,this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(n),this.render()},onMouseMove:function(n){this.addSprayChunk(n),this.render()},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,i,r,e,t,n,o,u,f;for(this.canvas.renderOnAddRemove=!1,i=[],r=0,e=this.sprayChunks.length;r<e;r++)for(t=this.sprayChunks[r],n=0,o=t.length;n<o;n++)u=new fabric.Rect({width:t[n].width,height:t[n].width,left:t[n].x+1,top:t[n].y+1,fill:this.color}),this.shadow&&u.setShadow(this.shadow),i.push(u);this.optimizeOverlapping&&(i=this._getOptimizedRects(i)),f=new fabric.Group(i),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.renderAll()},_getOptimizedRects:function(n){for(var r={},i,u,t=0,f=n.length;t<f;t++)i=n[t].left+""+n[t].top,r[i]||(r[i]=n[t]);u=[];for(i in r)u.push(r[i]);return u},render:function(){var t=this.canvas.contextTop,i,r,n;for(t.fillStyle=this.color,t.save(),i=0,r=this.sprayChunkPoints.length;i<r;i++)n=this.sprayChunkPoints[i],typeof n.opacity!="undefined"&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width);t.restore()},addSprayChunk:function(n){var u,f,e,t,i,r;for(this.sprayChunkPoints=[],t=this.width/2,i=0;i<this.density;i++)u=fabric.util.getRandomInt(n.x-t,n.x+t),f=fabric.util.getRandomInt(n.y-t,n.y+t),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,r={x:u,y:f,width:e},this.randomOpacity&&(r.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(r);this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+5,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,Math.PI*2,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(n){var t=this.callSuper("createPath",n);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var r=fabric.util.getPointer,o=fabric.util.degreesToRadians,s=fabric.util.radiansToDegrees,u=Math.atan2,n=Math.abs,f=Math.min,e=Math.max,t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={}),this._initStatic(n,t),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEvents(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(n){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(n,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.mouseXSign=t.originX==="right"?-1:1),t.originY!=="center"&&(t.mouseYSign=t.originY==="bottom"?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(n,t){var i=this.getPointer(n),r=this._normalizePointer(t,i);return t.containsPoint(r)||t._findTargetCorner(n,this._offset)},_normalizePointer:function(n,t){var i=this.getActiveGroup(),r=t.x,u=t.y,f=i&&n.type!=="group"&&i.contains(n);return f&&(r-=i.left,u-=i.top),{x:r,y:u}},isTargetTransparent:function(n,t,i){var e=this.contextCache,h=n.hasBorders,c=n.transparentCorners,r,u,f,o,s;for(n.hasBorders=n.transparentCorners=!1,this._draw(e,n),n.hasBorders=h,n.transparentCorners=c,this.targetFindTolerance>0&&(t>this.targetFindTolerance?t-=this.targetFindTolerance:t=0,i>this.targetFindTolerance?i-=this.targetFindTolerance:i=0),r=!0,u=e.getImageData(t,i,this.targetFindTolerance*2||1,this.targetFindTolerance*2||1),f=3,o=u.data.length;f<o;f+=4)if(s=u.data[f],r=s<=0,r===!1)break;return u=null,this.clearContext(e),r},_shouldClearSelection:function(n,t){var i=this.getActiveGroup();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey||t&&(!t.evented||!t.selectable)},_shouldCenterTransform:function(n,t){if(t){var i=this._currentTransform,r;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:i.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n.altKey:n.altKey}},_setupCurrentTransform:function(n,t){var s,i,u,f,e;t&&(s="drag",u=r(n,t.canvas.upperCanvasEl),i=t._findTargetCorner(n,this._offset),i&&(s=i==="ml"||i==="mr"?"scaleX":i==="mt"||i==="mb"?"scaleY":i==="mtr"?"rotate":"scale"),f=t.originX,e=t.originY,i==="ml"||i==="tl"||i==="bl"?f="right":(i==="mr"||i==="tr"||i==="br")&&(f="left"),i==="tl"||i==="mt"||i==="tr"?e="bottom":(i==="bl"||i==="mb"||i==="br")&&(e="top"),this._currentTransform={target:t,action:s,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:u.x-t.left,offsetY:u.y-t.top,originX:f,originY:e,ex:u.x,ey:u.y,left:t.left,top:t.top,theta:o(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:f,originY:e},this._resetCurrentTransform(n))},_shouldHandleGroupLogic:function(n,t){var i=this.getActiveObject();return n.shiftKey&&(this.getActiveGroup()||i&&i!==t)&&this.selection},_handleGroupLogic:function(n,t){var i;if(t!==this.getActiveGroup()||(t=this.findTarget(n,!0),t&&!t.isType("group"))){if(i=this.getActiveGroup(),i)i.contains(t)?(i.removeWithUpdate(t),this._resetObjectTransform(i),t.set("active",!1),i.size()===1&&this.discardActiveGroup()):(i.addWithUpdate(t),this._resetObjectTransform(i)),this.fire("selection:created",{target:i,e:n}),i.set("active",!0);else{if(this._activeObject&&t!==this._activeObject){var r=this.getObjects(),u=r.indexOf(this._activeObject)<r.indexOf(t),f=new fabric.Group(u?[t,this._activeObject]:[this._activeObject,t]);this.setActiveGroup(f),this._activeObject=null,i=this.getActiveGroup(),this.fire("selection:created",{target:i,e:n})}t.set("active",!0)}i&&i.saveCoords()}},_translateObject:function(n,t){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",n-this._currentTransform.offsetX),i.get("lockMovementY")||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(t,i,r){var f=this._currentTransform,v=this._offset,u=f.target,h=u.get("lockScalingX"),c=u.get("lockScalingY"),y,e,o,s,l,a;h&&c||(y=u.translateToOriginPoint(u.getCenterPoint(),f.originX,f.originY),e=u.toLocalPoint(new fabric.Point(t-v.left,i-v.top),f.originX,f.originY),f.originX==="right"?e.x*=-1:f.originX==="center"&&(e.x*=f.mouseXSign*2,e.x<0&&(f.mouseXSign=-f.mouseXSign)),f.originY==="bottom"?e.y*=-1:f.originY==="center"&&(e.y*=f.mouseYSign*2,e.y<0&&(f.mouseYSign=-f.mouseYSign)),n(e.x)>u.padding?e.x<0?e.x+=u.padding:e.x-=u.padding:e.x=0,n(e.y)>u.padding?e.y<0?e.y+=u.padding:e.y-=u.padding:e.y=0,o=u.scaleX,s=u.scaleY,r!=="equally"||h||c?r?r!=="x"||u.get("lockUniScaling")?r!=="y"||u.get("lockUniScaling")||(s=e.y/(u.height+u.strokeWidth),c||u.set("scaleY",s)):(o=e.x/(u.width+u.strokeWidth),h||u.set("scaleX",o)):(o=e.x/(u.width+u.strokeWidth),s=e.y/(u.height+u.strokeWidth),h||u.set("scaleX",o),c||u.set("scaleY",s)):(l=e.y+e.x,a=(u.height+u.strokeWidth)*f.original.scaleY+(u.width+u.strokeWidth)*f.original.scaleX,o=f.original.scaleX*l/a,s=f.original.scaleY*l/a,u.set("scaleX",o),u.set("scaleY",s)),o<0&&(f.originX==="left"?f.originX="right":f.originX==="right"&&(f.originX="left")),s<0&&(f.originY==="top"?f.originY="bottom":f.originY==="bottom"&&(f.originY="top")),u.setPositionByOrigin(y,f.originX,f.originY))},_rotateObject:function(n,t){var i=this._currentTransform,r=this._offset;if(!i.target.get("lockRotation")){var e=u(i.ey-i.top-r.top,i.ex-i.left-r.left),o=u(t-i.top-r.top,n-i.left-r.left),f=s(o-e+i.theta);f<0&&(f=360+f),i.target.angle=f}},_setCursor:function(n){this.upperCanvasEl.style.cursor=n},_resetObjectTransform:function(n){n.scaleX=1,n.scaleY=1,n.setAngle(0)},_drawSelection:function(){var i=this.contextTop,f=this._groupSelector,s=f.left,h=f.top,e=n(s),o=n(h),r,u;i.fillStyle=this.selectionColor,i.fillRect(f.ex-(s>0?0:-s),f.ey-(h>0?0:-h),e,o),i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1?(r=f.ex+t-(s>0?0:e),u=f.ey+t-(h>0?0:o),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+o-1,r+e,u+o-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+o,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+o,this.selectionDashArray),i.closePath(),i.stroke()):i.strokeRect(f.ex+t-(s>0?0:e),f.ey+t-(h>0?0:o),e,o)},_findSelectedObjects:function(n){for(var t=[],r=this._groupSelector.ex,u=this._groupSelector.ey,o=r+this._groupSelector.left,s=u+this._groupSelector.top,i,h=new fabric.Point(f(r,o),f(u,s)),c=new fabric.Point(e(r,o),e(u,s)),a=r===o&&u===s,l=this._objects.length;l--;)if((i=this._objects[l],i)&&(i.intersectsWithRect(h,c)||i.isContainedWithinRect(h,c)||i.containsPoint(h)||i.containsPoint(c))&&this.selection&&i.selectable&&(i.set("active",!0),t.push(i),a))break;t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t.reverse()),this.setActiveGroup(t),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},findTarget:function(n,t){var u,e,o,r,i,f,s,h;if(!this.skipTargetFind){if(e=this.getPointer(n),this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(n,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(n,this._offset))return this.lastRenderedObjectWithControlsAboveOverlay;if(o=this.getActiveGroup(),o&&!t&&this.containsPoint(n,o))return o;for(r=[],i=this._objects.length;i--;)if(this._objects[i]&&this._objects[i].visible&&this._objects[i].evented&&this.containsPoint(n,this._objects[i]))if(this.perPixelTargetFind||this._objects[i].perPixelTargetFind)r[r.length]=this._objects[i];else{u=this._objects[i],this.relatedTarget=u;break}for(f=0,s=r.length;f<s;f++)if(e=this.getPointer(n),h=this.isTargetTransparent(r[f],e.x,e.y),!h){u=r[f],this.relatedTarget=u;break}return u}},getPointer:function(n){var t=r(n,this.upperCanvasEl);return{x:t.x-this._offset.left,y:t.y-this._offset.top}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0}),n.width=t,n.height=i,fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(n,t){return this._activeObject&&this._activeObject.set("active",!1),this._activeObject=n,n.set("active",!0),this.renderAll(),this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){return this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null,this},setActiveGroup:function(n){return this._activeGroup=n,n&&(n.canvas=this,n.set("active",!0)),this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var n=this.getActiveGroup();return n&&n.destroy(),this.setActiveGroup(null)},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].set("active",!1);return this.discardActiveGroup(),this.discardActiveObject(),this},deactivateAllWithDispatch:function(){var n=this.getActiveGroup()||this.getActiveObject();return n&&this.fire("before:selection:cleared",{target:n}),this.deactivateAll(),n&&this.fire("selection:cleared"),this},drawControls:function(n){var i=this.getActiveGroup(),t,r;if(i)n.save(),fabric.Group.prototype.transform.call(i,n),i.drawBorders(n).drawControls(n),n.restore();else for(t=0,r=this._objects.length;t<r;++t)this._objects[t]&&this._objects[t].active&&(n.save(),fabric.Object.prototype.transform.call(this._objects[t],n),this._objects[t].drawBorders(n).drawControls(n),n.restore(),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t])}});for(i in fabric.StaticCanvas)i!=="prototype"&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var u=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,t=fabric.util.removeListener,r=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var t=this;this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=function(n,i){t.__onTransformGesture(n,i)},n(fabric.window,"resize",this._onResize),fabric.isTouchSupported?(n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",this._onGesture)):(n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove))},_onMouseDown:function(i){this.__onMouseDown(i),fabric.isTouchSupported||n(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&n(fabric.document,"touchend",this._onMouseUp),fabric.isTouchSupported||n(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&n(fabric.document,"touchmove",this._onMouseMove),fabric.isTouchSupported||t(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&t(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(i){this.__onMouseUp(i),fabric.isTouchSupported||t(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&t(fabric.document,"touchend",this._onMouseUp),fabric.isTouchSupported||t(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&t(fabric.document,"touchmove",this._onMouseMove),fabric.isTouchSupported||n(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&n(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault(),this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n,t){var i=this.getActiveGroup()||this.getActiveObject();return n&&(n.isMoving||n!==i)||!n&&i||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y)},__onMouseUp:function(n){var t,u,f,e,r,i,o;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:n});return}this._currentTransform?(e=this._currentTransform,t=e.target,t._scaling&&(t._scaling=!1),t.setCoords(),this.stateful&&t.hasStateChanged()&&(this.fire("object:modified",{target:t}),t.fire("modified")),this._previousOriginX&&this._previousOriginY&&(r=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY),t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=r.x,t.top=r.y,this._previousOriginX=null,this._previousOriginY=null)):u=this.getPointer(n),f=this._shouldRender(t,u),this.selection&&this._groupSelector&&this._findSelectedObjects(n),i=this.getActiveGroup(),i&&(i.setObjectsCoords(),i.isMoving=!1,this._setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null,t&&(t.isMoving=!1),f&&this.renderAll(),this._setCursorFromEvent(n,t),o=this,setTimeout(function(){o._setCursorFromEvent(n,t)},50),this.fire("mouse:up",{target:t,e:n}),t&&t.fire("mouseup",{e:n})},_onMouseDownInDrawingMode:function(n){this._isCurrentlyDrawing=!0,this.discardActiveObject().renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);this.freeDrawingBrush.onMouseDown(this.getPointer(n));this.fire("mouse:down",{e:n})},__onMouseDown:function(n){var u="which"in n?n.which===1:n.button===1,t,i,f,r;if(u||fabric.isTouchSupported){if(this.isDrawingMode){this._onMouseDownInDrawingMode(n);return}if(!this._currentTransform){if(t=this.findTarget(n),i=this.getPointer(n),this._previousPointer=i,r=this._shouldRender(t,i),this._shouldClearSelection(n,t))this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),this.deactivateAllWithDispatch(),t&&t.selectable&&this.setActiveObject(t,n);else if(this._shouldHandleGroupLogic(n,t))this._handleGroupLogic(n,t),t=this.getActiveGroup();else{if(this.stateful&&t.saveState(),f=t._findTargetCorner(n,this._offset))this.onBeforeScaleRotate(t);t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,n)),this._setupCurrentTransform(n,t)}r&&this.renderAll(),this.fire("mouse:down",{target:t,e:n}),t&&t.fire("mousedown",{e:n})}}},_setOriginToCenter:function(n){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var t=n.getCenterPoint();n.originX="center",n.originY="center",n.left=t.x,n.top=t.y,this._currentTransform.left=n.left,this._currentTransform.top=n.top},_setCenterToOrigin:function(n){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX,n.originY=this._previousOriginY,n.left=t.x,n.top=t.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(n){var t,u,f,h;if(this.isDrawingMode){if(this._isCurrentlyDrawing){u=this.getPointer(n);this.freeDrawingBrush.onMouseMove(u)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor,this.fire("mouse:move",{e:n});return}if(f=this._groupSelector,f)u=r(n,this.upperCanvasEl),f.left=u.x-this._offset.left-f.ex,f.top=u.y-this._offset.top-f.ey,this.renderTop();else if(this._currentTransform){u=r(n,this.upperCanvasEl);var e=u.x,o=u.y,c=!1,s,i=this._currentTransform;t=i.target,t.isMoving=!0,(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY")&&(s=this._shouldCenterTransform(n,t),(s&&(i.originX!=="center"||i.originY!=="center")||!s&&i.originX==="center"&&i.originY==="center")&&(this._resetCurrentTransform(n),c=!0)),i.action==="rotate"?(this._rotateObject(e,o),this.fire("object:rotating",{target:t,e:n}),t.fire("rotating",{e:n})):i.action==="scale"?((n.shiftKey||this.uniScaleTransform)&&!t.get("lockUniScaling")?(i.currentAction="scale",this._scaleObject(e,o)):(c||i.currentAction!=="scale"||this._resetCurrentTransform(n,t),i.currentAction="scaleEqually",this._scaleObject(e,o,"equally")),this.fire("object:scaling",{target:t,e:n}),t.fire("scaling",{e:n})):i.action==="scaleX"?(this._scaleObject(e,o,"x"),this.fire("object:scaling",{target:t,e:n}),t.fire("scaling",{e:n})):i.action==="scaleY"?(this._scaleObject(e,o,"y"),this.fire("object:scaling",{target:t,e:n}),t.fire("scaling",{e:n})):(this._translateObject(e,o),this.fire("object:moving",{target:t,e:n}),t.fire("moving",{e:n}),this._setCursor(this.moveCursor)),this.renderAll()}else h=this.upperCanvasEl.style,t=this.findTarget(n),t&&(!t||t.selectable)?this._setCursorFromEvent(n,t):h.cursor=this.defaultCursor;this.fire("mouse:move",{target:t,e:n}),t&&t.fire("mousemove",{e:n})},_setCursorFromEvent:function(n,t){var f=this.upperCanvasEl.style,o,e,r;if(t)if(o=this.getActiveGroup(),e=t._findTargetCorner&&(!o||!o.contains(t))&&t._findTargetCorner(n,this._offset),e)if(e in i)r=Math.round(t.getAngle()%360/45),r<0&&(r+=8),r+=i[e],r%=8,f.cursor=u[r];else if(e==="mtr"&&t.hasRotatingPoint)f.cursor=this.rotationCursor;else return f.cursor=this.defaultCursor,!1;else f.cursor=t.hoverCursor||this.hoverCursor;else return f.cursor=this.defaultCursor,!1;return!0}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=n.multiplier||1,u={left:n.left,top:n.top,width:n.width,height:n.height};return r!==1?this.__toDataURLWithMultiplier(t,i,u,r):this.__toDataURL(t,i,u)},__toDataURL:function(n,t,i){var u,r,f;return this.renderAll(!0),u=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(u,i),n==="jpg"&&(n="jpeg"),f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||u).toDataURL("image/"+n,t):(r||u).toDataURL("image/"+n),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),f},__getCroppedCanvas:function(n,t){var i,r,u="left"in t||"top"in t||"width"in t||"height"in t;return u&&(i=fabric.util.createCanvasElement(),r=i.getContext("2d"),i.width=t.width||this.width,i.height=t.height||this.height,r.drawImage(n,-t.left||0,-t.top||0)),i},__toDataURLWithMultiplier:function(n,t,i,r){var f=this.getWidth(),e=this.getHeight(),c=f*r,l=e*r,o=this.getActiveObject(),u=this.getActiveGroup(),s=this.contextTop||this.contextContainer,h;return this.setWidth(c).setHeight(l),s.scale(r,r),i.left&&(i.left*=r),i.top&&(i.top*=r),i.width&&(i.width*=r),i.height&&(i.height*=r),u?this._tempRemoveBordersControlsFromGroup(u):o&&this.deactivateAll&&this.deactivateAll(),this.width=f,this.height=e,this.renderAll(!0),h=this.__toDataURL(n,t,i),s.scale(1/r,1/r),this.setWidth(f).setHeight(e),u?this._restoreBordersControlsOnGroup(u):o&&this.setActiveObject&&this.setActiveObject(o),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),h},toDataURLWithMultiplier:function(n,t,i){return this.toDataURL({format:n,multiplier:t,quality:i})},_tempRemoveBordersControlsFromGroup:function(n){n.origHasControls=n.hasControls,n.origBorderColor=n.borderColor,n.hasControls=!0,n.borderColor="rgba(0,0,0,0)",n.forEachObject(function(n){n.origBorderColor=n.borderColor,n.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(n){n.hideControls=n.origHideControls,n.borderColor=n.origBorderColor,n.forEachObject(function(n){n.borderColor=n.origBorderColor,delete n.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){var r,u;if(n)return r=typeof n=="string"?JSON.parse(n):n,this.clear(),u=this,this._enlivenObjects(r.objects,function(){u._setBgOverlayImages(r,t)},i),this},_setBgOverlayImages:function(n,t){var i=this,r,u,f,e=function(){t&&u&&f&&r&&t()};n.backgroundImage?this.setBackgroundImage(n.backgroundImage,function(){i.backgroundImageOpacity=n.backgroundImageOpacity,i.backgroundImageStretch=n.backgroundImageStretch,i.renderAll(),u=!0,e()}):u=!0,n.overlayImage?this.setOverlayImage(n.overlayImage,function(){i.overlayImageLeft=n.overlayImageLeft||0,i.overlayImageTop=n.overlayImageTop||0,i.renderAll(),f=!0,e()}):f=!0,n.background?this.setBackgroundColor(n.background,function(){i.renderAll(),r=!0,e()}):r=!0,n.backgroundImage||n.overlayImage||n.background||t&&t()},_enlivenObjects:function(n,t,i){var r=this,u;n.length===0&&t&&t(),u=this.renderOnAddRemove,this.renderOnAddRemove=!1,fabric.util.enlivenObjects(n,function(n){n.forEach(function(n,t){r.insertAt(n,t,!0)}),r.renderOnAddRemove=u,t&&t()},null,i)},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n){var t=JSON.stringify(this);this.cloneWithoutData(function(i){i.loadFromJSON(t,function(){n&&n(i)})})},cloneWithoutData:function(n){var i=fabric.document.createElement("canvas"),t;i.width=this.getWidth(),i.height=this.getHeight(),t=new fabric.Canvas(i),t.clipTo=this.clipTo,this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll(),n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i=t.util.toFixed,u=t.util.string.capitalize,f=t.util.degreesToRadians,e=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!1,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(n){n&&this.setOptions(n)},_initGradient:function(n){!n.fill||!n.fill.colorStops||n.fill instanceof t.Gradient||this.set("fill",new t.Gradient(n.fill))},_initPattern:function(n){!n.fill||!n.fill.source||n.fill instanceof t.Pattern||this.set("fill",new t.Pattern(n.fill)),!n.stroke||!n.stroke.source||n.stroke instanceof t.Pattern||this.set("stroke",new t.Pattern(n.stroke))},_initClipping:function(n){if(n.clipTo&&typeof n.clipTo=="string"){var i=t.util.getFunctionBody(n.clipTo);typeof i!="undefined"&&(this.clipTo=new Function("ctx",i))}},setOptions:function(n){for(var t in n)this.set(t,n[t]);this._initGradient(n),this._initPattern(n),this._initClipping(n)},transform:function(n,t){n.globalAlpha=this.opacity;var i=t?this._getLeftTopCoords():this.getCenterPoint();n.translate(i.x,i.y),n.rotate(f(this.angle)),n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.getAngle(),r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(u=this._removeDefaultValues(u)),t.util.populateWithProperties(this,u,n),u},toDatalessObject:function(n){return this.toObject(n)},getSvgStyles:function(){var n=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",i=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"",u=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",e=this.strokeMiterLimit?this.strokeMiterLimit:"4",o=typeof this.opacity!="undefined"?this.opacity:"1",s=this.visible?"":" visibility: hidden;",h=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",t,"; ","stroke-width: ",i,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",u,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",e,"; ","fill: ",n,"; ","opacity: ",o,";",h,s].join("")},getSvgTransform:function(){var r=this.getAngle(),u=this.getCenterPoint(),n=t.Object.NUM_FRACTION_DIGITS,f="translate("+i(u.x,n)+" "+i(u.y,n)+")",e=r!==0?" rotate("+i(r,n)+")":"",o=this.scaleX===1&&this.scaleY===1?"":" scale("+i(this.scaleX,n)+" "+i(this.scaleY,n)+")",s=this.flipX?"matrix(-1 0 0 1 0 0) ":"",h=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[f,e,o,s,h].join("")},_createBaseSVGMarkup:function(){var n=[];return this.fill&&this.fill.toLive&&n.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&n.push(this.stroke.toSVG(this,!1)),this.shadow&&n.push(this.shadow.toSVG(this)),n},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},toString:function(){return"#<fabric."+u(this.type)+">"},get:function(n){return this[n]},set:function(n,t){if(typeof n=="object")for(var i in n)this._set(i,n[i]);else typeof t=="function"&&n!=="clipTo"?this._set(n,t(this.get(n))):this._set(n,t);return this},_set:function(n,r){var u=n==="scaleX"||n==="scaleY";return u&&(r=this._constrainScale(r)),n==="scaleX"&&r<0?(this.flipX=!this.flipX,r*=-1):n==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):n==="width"||n==="height"?this.minScaleLimit=i(Math.min(.1,1/Math.max(this.width,this.height)),2):n!=="shadow"||!r||r instanceof t.Shadow||(r=new t.Shadow(r)),this[n]=r,this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},render:function(n,i){if(this.width!==0&&this.height!==0&&this.visible){n.save();var r=this.transformMatrix;r&&!this.group&&n.setTransform(r[0],r[1],r[2],r[3],r[4],r[5]),i||this.transform(n),this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke),this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n):this.fill),r&&this.group&&(n.translate(-this.group.width/2,-this.group.height/2),n.transform(r[0],r[1],r[2],r[3],r[4],r[5])),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),this._render(n,i),this.clipTo&&n.restore(),this._removeShadow(n),this.active&&!i&&(this.drawBorders(n),this.drawControls(n)),n.restore()}},_setShadow:function(n){this.shadow&&(n.shadowColor=this.shadow.color,n.shadowBlur=this.shadow.blur,n.shadowOffsetX=this.shadow.offsetX,n.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(n){n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0},_renderFill:function(n){this.fill&&(this.fill.toLive&&(n.save(),n.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),n.fill(),this.fill.toLive&&n.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n))},_renderStroke:function(n){this.stroke&&(n.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(n.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(n)):this._renderDashedStroke&&this._renderDashedStroke(n),n.stroke()):this._stroke?this._stroke(n):n.stroke(),this._removeShadow(n),n.restore())},clone:function(n,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),n):new t.Object(this.toObject(i))},cloneAsImage:function(n){var i=this.toDataURL();return t.util.loadImage(i,function(i){n&&n(new t.Image(i))}),this},toDataURL:function(n){var i,u,r,f,e;return n||(n={}),i=t.util.createCanvasElement(),u=this.getBoundingRect(),i.width=u.width,i.height=u.height,t.util.wrapElement(i,"div"),r=new t.Canvas(i),n.format==="jpg"&&(n.format="jpeg"),n.format==="jpeg"&&(r.backgroundColor="#fff"),f={active:this.get("active"),left:this.getLeft(),top:this.getTop()},this.set("active",!1),this.setPositionByOrigin(new t.Point(i.width/2,i.height/2),"center","center"),r.add(this),e=r.toDataURL(n),this.set(f).setCoords(),r.dispose(),r=null,e},isType:function(n){return this.type===n},complexity:function(){return 0},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){var r,u,f;i||(i={}),r={colorStops:[]},r.type=i.type||(i.r1||i.r2?"radial":"linear"),r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2);for(u in i.colorStops)f=new t.Color(i.colorStops[u]),r.colorStops.push({offset:u,color:f.toRgb(),opacity:f.getAlpha()});return this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n){return this.set("fill",new t.Pattern(n))},setShadow:function(n){return this.set("shadow",new t.Shadow(n))},setColor:function(n){return this.set("fill",n),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group?t.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,r(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,i,r){var u=t.x,f=t.y;return i==="left"?u=t.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:i==="right"&&(u=t.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2),r==="top"?f=t.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:r==="bottom"&&(f=t.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(u,f),t,n(this.angle))},translateToOriginPoint:function(t,i,r){var u=t.x,f=t.y;return i==="left"?u=t.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:i==="right"&&(u=t.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2),r==="top"?f=t.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:r==="bottom"&&(f=t.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(u,f),t,n(this.angle))},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var u=this.getCenterPoint(),f,e;return i!==undefined&&r!==undefined?(f=i==="left"?u.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:i==="right"?u.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:u.x,e=r==="top"?u.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:r==="bottom"?u.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:u.y):(f=this.left,e=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),u,-n(this.angle)).subtractEquals(new fabric.Point(f,e))},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(t){var i=n(this.angle),r=this.getWidth()/2,u=Math.cos(i)*r,f=Math.sin(i)*r,e=this.getWidth(),o=Math.cos(i)*e,s=Math.sin(i)*e;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=u,this.top-=f):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="left"&&t==="right"?(this.left+=o,this.top+=s):this.originX==="right"&&t==="left"&&(this.left-=o,this.top-=s),this.setCoords(),this.originX=t},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(n,t){var i=this.oCoords,r=new fabric.Point(i.tl.x,i.tl.y),u=new fabric.Point(i.tr.x,i.tr.y),f=new fabric.Point(i.bl.x,i.bl.y),e=new fabric.Point(i.br.x,i.br.y),o=fabric.Intersection.intersectPolygonRectangle([r,u,e,f],n,t);return o.status==="Intersection"},intersectsWithObject:function(n){function r(n){return{tl:new fabric.Point(n.tl.x,n.tl.y),tr:new fabric.Point(n.tr.x,n.tr.y),bl:new fabric.Point(n.bl.x,n.bl.y),br:new fabric.Point(n.br.x,n.br.y)}}var t=r(this.oCoords),i=r(n.oCoords),u=fabric.Intersection.intersectPolygonPolygon([t.tl,t.tr,t.br,t.bl],[i.tl,i.tr,i.br,i.bl]);return u.status==="Intersection"},isContainedWithinObject:function(n){var t=n.getBoundingRect(),i=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(i,r)},isContainedWithinRect:function(n,t){var i=this.getBoundingRect();return i.left>n.x&&i.left+i.width<t.x&&i.top>n.y&&i.top+i.height<t.y},containsPoint:function(n){var i=this._getImageLines(this.oCoords),t=this._findCrossPoints(n,i);return t!==0&&t%2==1},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,f,e,s,u,h,o=0,i,c;for(c in t)if((i=t[c],!(i.o.y<n.y)||!(i.d.y<n.y))&&(!(i.o.y>=n.y)||!(i.d.y>=n.y))&&(i.o.x===i.d.x&&i.o.x>=n.x?(u=i.o.x,h=n.y):(r=0,f=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=n.y-r*n.x,s=i.o.y-f*i.o.x,u=-(e-s)/(r-f),h=e+r*u),u>=n.x&&(o+=1),o===2))break;return o},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var n=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(n),u=fabric.util.array.max(n),f=Math.abs(t-u),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],r=fabric.util.array.min(i),e=fabric.util.array.max(i),o=Math.abs(r-e);return{left:t,top:r,width:f,height:o}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n},scale:function(n){return n=this._constrainScale(n),n<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,n*=-1),this.scaleX=n,this.scaleY=n,this.setCoords(),this},scaleToWidth:function(n){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(n/this.width/t)},scaleToHeight:function(n){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(n/this.height/t)},setCoords:function(){var s=this.strokeWidth>1?this.strokeWidth:0,h=this.padding,f=n(this.angle);this.currentWidth=(this.width+s)*this.scaleX+h*2,this.currentHeight=(this.height+s)*this.scaleY+h*2,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var c=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),l=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),v=Math.cos(l+f)*c,y=Math.sin(l+f)*c,i=Math.sin(f),r=Math.cos(f),a=this.getCenterPoint(),t={x:a.x-v,y:a.y-y},u={x:t.x+this.currentWidth*r,y:t.y+this.currentWidth*i},p={x:u.x-this.currentHeight*i,y:u.y+this.currentHeight*r},e={x:t.x-this.currentHeight*i,y:t.y+this.currentHeight*r},w={x:t.x-this.currentHeight/2*i,y:t.y+this.currentHeight/2*r},o={x:t.x+this.currentWidth/2*r,y:t.y+this.currentWidth/2*i},b={x:u.x-this.currentHeight/2*i,y:u.y+this.currentHeight/2*r},k={x:e.x+this.currentWidth/2*r,y:e.y+this.currentWidth/2*i},d={x:o.x,y:o.y};return this.oCoords={tl:t,tr:u,br:p,bl:e,ml:w,mt:o,mr:b,mb:k,mtr:d},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(n){return this.get(n)!==this.originalState[n]},this)},saveState:function(n){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),n&&n.stateProperties&&n.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var t=fabric.util.getPointer,n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(n,i){var r;if(!this.hasControls||!this.active)return!1;var f=t(n,this.canvas.upperCanvasEl),o=f.x-i.left,s=f.y-i.top,u,e;for(r in this.oCoords)if((r!=="mtr"||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||r!=="mt"&&r!=="mr"&&r!=="mb"&&r!=="ml")&&(e=this._getImageLines(this.oCoords[r].corner),u=this._findCrossPoints({x:o,y:s},e),u!==0&&u%2==1))return this.__corner=r,r;return!1},_setCornerCoords:function(){var t=this.oCoords,e=n(this.angle),o=n(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,i=s*Math.cos(o),r=s*Math.sin(o),u=Math.sin(e),f=Math.cos(e);t.tl.corner={tl:{x:t.tl.x-r,y:t.tl.y-i},tr:{x:t.tl.x+i,y:t.tl.y-r},bl:{x:t.tl.x-i,y:t.tl.y+r},br:{x:t.tl.x+r,y:t.tl.y+i}},t.tr.corner={tl:{x:t.tr.x-r,y:t.tr.y-i},tr:{x:t.tr.x+i,y:t.tr.y-r},br:{x:t.tr.x+r,y:t.tr.y+i},bl:{x:t.tr.x-i,y:t.tr.y+r}},t.bl.corner={tl:{x:t.bl.x-r,y:t.bl.y-i},bl:{x:t.bl.x-i,y:t.bl.y+r},br:{x:t.bl.x+r,y:t.bl.y+i},tr:{x:t.bl.x+i,y:t.bl.y-r}},t.br.corner={tr:{x:t.br.x+i,y:t.br.y-r},bl:{x:t.br.x-i,y:t.br.y+r},br:{x:t.br.x+r,y:t.br.y+i},tl:{x:t.br.x-r,y:t.br.y-i}},t.ml.corner={tl:{x:t.ml.x-r,y:t.ml.y-i},tr:{x:t.ml.x+i,y:t.ml.y-r},bl:{x:t.ml.x-i,y:t.ml.y+r},br:{x:t.ml.x+r,y:t.ml.y+i}},t.mt.corner={tl:{x:t.mt.x-r,y:t.mt.y-i},tr:{x:t.mt.x+i,y:t.mt.y-r},bl:{x:t.mt.x-i,y:t.mt.y+r},br:{x:t.mt.x+r,y:t.mt.y+i}},t.mr.corner={tl:{x:t.mr.x-r,y:t.mr.y-i},tr:{x:t.mr.x+i,y:t.mr.y-r},bl:{x:t.mr.x-i,y:t.mr.y+r},br:{x:t.mr.x+r,y:t.mr.y+i}},t.mb.corner={tl:{x:t.mb.x-r,y:t.mb.y-i},tr:{x:t.mb.x+i,y:t.mb.y-r},bl:{x:t.mb.x-i,y:t.mb.y+r},br:{x:t.mb.x+r,y:t.mb.y+i}},t.mtr.corner={tl:{x:t.mtr.x-r+u*this.rotatingPointOffset,y:t.mtr.y-i-f*this.rotatingPointOffset},tr:{x:t.mtr.x+i+u*this.rotatingPointOffset,y:t.mtr.y-r-f*this.rotatingPointOffset},bl:{x:t.mtr.x-i+u*this.rotatingPointOffset,y:t.mtr.y+r-f*this.rotatingPointOffset},br:{x:t.mtr.x+r+u*this.rotatingPointOffset,y:t.mtr.y+i-f*this.rotatingPointOffset}}},drawBorders:function(n){var o,s,u,r,f;if(!this.hasBorders)return this;var i=this.padding,e=i*2,t=~~(this.strokeWidth/2)*2;return n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=this.borderColor,o=1/this._constrainScale(this.scaleX),s=1/this._constrainScale(this.scaleY),n.lineWidth=1/this.borderScaleFactor,n.scale(o,s),u=this.getWidth(),r=this.getHeight(),n.strokeRect(~~(-(u/2)-i-t/2*this.scaleX)-.5,~~(-(r/2)-i-t/2*this.scaleY)-.5,~~(u+e+t*this.scaleX)+1,~~(r+e+t*this.scaleY)+1),this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls&&(f=(this.flipY?r+t*this.scaleY+i*2:-r-t*this.scaleY-i*2)/2,n.beginPath(),n.moveTo(0,f),n.lineTo(0,f+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),n.closePath(),n.stroke()),n.restore(),this},drawControls:function(n){if(!this.hasControls)return this;var w=this.cornerSize,k=w/2,f=~~(this.strokeWidth/2),o=-(this.width/2),e=-(this.height/2),t,i,u=w/this.scaleX,r=w/this.scaleY,v=this.padding/this.scaleX,l=this.padding/this.scaleY,b=k/this.scaleY,a=k/this.scaleX,g=(k-w)/this.scaleX,d=(k-w)/this.scaleY,y=this.height,p=this.width,s=this.transparentCorners?"strokeRect":"fillRect",h=this.transparentCorners,c=typeof G_vmlCanvasManager!="undefined";return n.save(),n.lineWidth=1/Math.max(this.scaleX,this.scaleY),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=n.fillStyle=this.cornerColor,t=o-a-f-v,i=e-b-f-l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o+p-a+f+v,i=e-b-f-l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o-a-f-v,i=e+y+d+f+l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o+p+g+f+v,i=e+y+d+f+l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),this.get("lockUniScaling")||(t=o+p/2-a,i=e-b-f-l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o+p/2-a,i=e+y+d+f+l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o+p+g+f+v,i=e+y/2-b,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r),t=o-a-f-v,i=e+y/2-b,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r)),this.hasRotatingPoint&&(t=o+p/2-a,i=this.flipY?e+y+this.rotatingPointOffset/this.scaleY-r/2+f+l:e-this.rotatingPointOffset/this.scaleY-r/2-f-l,c||h||n.clearRect(t,i,u,r),n[s](t,i,u,r)),n.restore(),this}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t),f.renderAll(),u()},onComplete:function(){n.setCoords(),r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t),f.renderAll(),u()},onComplete:function(){n.setCoords(),r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.set("active",!1)},onChange:function(t){n.set("opacity",t),r.renderAll(),f()},onComplete:function(){r.remove(n),u()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var i,n,u,t,r;if(arguments[0]&&typeof arguments[0]=="object"){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;t<r;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var f=this,u,e;t=t.toString(),i=i?fabric.util.object.clone(i):{},~n.indexOf(".")&&(u=n.split(".")),e=u?this.get(u[0])[u[1]]:this.get(n),"from"in i||(i.from=e),t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t){(u?f[u[0]][u[1]]=t:f.set(n,t),r)||i.onChange&&i.onChange()},onComplete:function(){r||(f.setCoords(),i.onComplete&&i.onComplete())}})}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},u=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",initialize:function(n,t){t=t||{},n||(n=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",n[0]),this.set("y1",n[1]),this.set("x2",n[2]),this.set("y2",n[3]),this._setWidthHeight(t)},_setWidthHeight:function(n){n||(n={}),this.set("width",Math.abs(this.x2-this.x1)||1),this.set("height",Math.abs(this.y2-this.y1)||1),this.set("left","left"in n?n.left:Math.min(this.x1,this.x2)+this.width/2),this.set("top","top"in n?n.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(n,t){return this[n]=t,n in r&&this._setWidthHeight(),this},_render:function(n){var r,t,i,f;n.beginPath(),r=this.group&&this.group.type!=="group",r&&!this.transformMatrix&&n.translate(-this.group.width/2+this.left,-this.group.height/2+this.top),(!this.strokeDashArray||this.strokeDashArray&&u)&&(t=this.x1<=this.x2?-1:1,i=this.y1<=this.y2?-1:1,n.moveTo(this.width===1?0:t*this.width/2,this.height===1?0:i*this.height/2),n.lineTo(this.width===1?0:t*-1*this.width/2,this.height===1?0:i*-1*this.height/2)),n.lineWidth=this.strokeWidth,f=n.strokeStyle,n.strokeStyle=this.stroke||n.fillStyle,this._renderStroke(n),n.strokeStyle=f},_renderDashedStroke:function(n){var u=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,i=this.width===1?0:u*this.width/2,r=this.height===1?0:f*this.height/2;n.beginPath(),t.util.drawDashedLine(n,i,r,-i,-r,this.strokeDashArray),n.closePath()},toObject:function(n){return i(this.callSuper("toObject",n),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(n,r){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,i(u,r))},t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return"radius"in n&&n.radius>0}var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",initialize:function(n){n=n||{},this.set("radius",n.radius||0),this.callSuper("initialize",n)},_set:function(n,t){return this.callSuper("_set",n,t),n==="radius"&&this.setRadius(t),this},toObject:function(n){return i(this.callSuper("toObject",n),{radius:this.get("radius")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath(),n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity,n.arc(t?this.left:0,t?this.top:0,this.radius,0,r,!1),n.closePath(),this._renderFill(n),this._renderStroke(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n,this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(n,r){var f,e;if(r||(r={}),f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES),!u(f))throw new Error("value of `r` attribute is required and can not be negative");return"left"in f&&(f.left-=r.width/2||0),"top"in f&&(f.top-=r.height/2||0),e=new t.Circle(i(f,r)),e.cx=parseFloat(n.getAttribute("cx"))||0,e.cy=parseFloat(n.getAttribute("cy"))||0,e},t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{},this.callSuper("initialize",n),this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath(),n.moveTo(-i,t),n.lineTo(0,-t),n.lineTo(i,t),n.closePath(),this._renderFill(n),this._renderStroke(n)},_renderDashedStroke:function(n){var r=this.width/2,i=this.height/2;n.beginPath(),t.util.drawDashedLine(n,-r,i,0,-i,this.strokeDashArray),t.util.drawDashedLine(n,0,-i,r,i,this.strokeDashArray),t.util.drawDashedLine(n,r,i,-r,i,this.strokeDashArray),n.closePath()},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=this.width/2,i=this.height/2,u=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return t.push("<polygon ",'points="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}}),t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(n){n=n||{},this.callSuper("initialize",n),this.set("rx",n.rx||0),this.set("ry",n.ry||0),this.set("width",this.get("rx")*2),this.set("height",this.get("ry")*2)},toObject:function(n){return i(this.callSuper("toObject",n),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},render:function(n,t){if(this.rx!==0&&this.ry!==0)return this.callSuper("render",n,t)},_render:function(n,t){n.beginPath(),n.save(),n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&this.group&&n.translate(this.cx,this.cy),n.transform(1,0,0,this.ry/this.rx,0,0),n.arc(t?this.left:0,t?this.top:0,this.rx,0,r,!1),this._renderFill(n),this._renderStroke(n),n.restore()},complexity:function(){return 1}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(n,r){var f;r||(r={});var u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES),e=u.left,o=u.top;return"left"in u&&(u.left-=r.width/2||0),"top"in u&&(u.top-=r.height/2||0),f=new t.Ellipse(i(u,r)),f.cx=e||0,f.cy=o||0,f},t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return n.left=n.left||0,n.top=n.top||0,n}var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i;if(t.Rect){console.warn("fabric.Rect is already defined");return}i=t.Object.prototype.stateProperties.concat(),i.push("rx","ry","x","y"),t.Rect=t.util.createClass(t.Object,{stateProperties:i,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(n){n=n||{},this.callSuper("initialize",n),this._initRxRy(),this.x=n.x||0,this.y=n.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n){var r=this.rx||0,e=this.ry||0,t=-this.width/2,i=-this.height/2,u=this.width,f=this.height,s=this.group&&this.group.type!=="group",o;n.beginPath(),n.globalAlpha=s?n.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&s&&n.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&s&&n.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),o=r!==0||e!==0,n.moveTo(t+r,i),n.lineTo(t+u-r,i),o&&n.quadraticCurveTo(t+u,i,t+u,i+e,t+u,i+e),n.lineTo(t+u,i+f-e),o&&n.quadraticCurveTo(t+u,i+f,t+u-r,i+f,t+u-r,i+f),n.lineTo(t+r,i+f),o&&n.quadraticCurveTo(t,i+f,t,i+f-e,t,i+f-e),n.lineTo(t,i+e),o&&n.quadraticCurveTo(t,i,t+r,i,t+r,i),n.closePath(),this._renderFill(n),this._renderStroke(n)},_renderDashedStroke:function(n){var i=-this.width/2,r=-this.height/2,u=this.width,f=this.height;n.beginPath(),t.util.drawDashedLine(n,i,r,i+u,r,this.strokeDashArray),t.util.drawDashedLine(n,i+u,r,i+u,r+f,this.strokeDashArray),t.util.drawDashedLine(n,i+u,r+f,i,r+f,this.strokeDashArray),t.util.drawDashedLine(n,i,r+f,i,r,this.strokeDashArray),n.closePath()},_normalizeLeftTopProperties:function(n){return"left"in n&&this.set("left",n.left+this.getWidth()/2),this.set("x",n.left||0),"top"in n&&this.set("top",n.top+this.getHeight()/2),this.set("y",n.top||0),this},toObject:function(n){var t=r(this.callSuper("toObject",n),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<rect ",'x="',this.width/-2,'" y="',this.height/-2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(n,i){var f,e;return n?(f=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES),f=u(f),e=new t.Rect(r(i?t.util.object.clone(i):{},f)),e._normalizeLeftTopProperties(f),e):null},t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed,r=t.util.array.min;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",initialize:function(n,t,i){t=t||{},this.set("points",n),this.callSuper("initialize",t),this._calcDimensions(i)},_calcDimensions:function(n){return t.Polygon.prototype._calcDimensions.call(this,n)},toObject:function(n){return t.Polygon.prototype.toObject.call(this,n)},toSVG:function(n){for(var u=[],r=this._createBaseSVGMarkup(),t=0,f=this.points.length;t<f;t++)u.push(i(this.points[t].x,2),",",i(this.points[t].y,2)," ");return r.push("<polyline ",'points="',u.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(r.join("")):r.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n),this._renderStroke(n)},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||r,t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElement=function(n,i){var e,s;if(!n)return null;i||(i={});var u=t.parsePointsAttribute(n.getAttribute("points")),h=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES),f=r(u,"x"),o=r(u,"y");for(f=f<0?f:0,o=f<0?o:0,e=0,s=u.length;e<s;e++)u[e].x-=i.width/2+f||0,u[e].y-=i.height/2+o||0;return new t.Polyline(u,t.util.object.extend(h,i),!0)},t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",initialize:function(n,t,i){t=t||{},this.points=n,this.callSuper("initialize",t),this._calcDimensions(i)},_calcDimensions:function(n){var t=this.points,r=i(t,"x"),f=i(t,"y"),s=u(t,"x"),h=u(t,"y"),e,o;(this.width=s-r||1,this.height=h-f||1,this.minX=r,this.minY=f,n)||(e=this.width/2+this.minX,o=this.height/2+this.minY,this.points.forEach(function(n){n.x-=e,n.y-=o},this))},toObject:function(n){return r(this.callSuper("toObject",n),{points:this.points.concat()})},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),t=0,u=this.points.length;t<u;t++)r.push(f(this.points[t].x,2),",",f(this.points[t].y,2)," ");return i.push("<polygon ",'points="',r.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(i.join("")):i.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n),(this.stroke||this.strokeDashArray)&&(n.closePath(),this._renderStroke(n))},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||this.points[0],t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray);n.closePath()},complexity:function(){return this.points.length}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=function(n,u){var o,h;if(!n)return null;u||(u={});var f=t.parsePointsAttribute(n.getAttribute("points")),c=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES),e=i(f,"x"),s=i(f,"y");for(e=e<0?e:0,s=e<0?s:0,o=0,h=f.length;o<h;o++)f[o].x-=u.width/2+e||0,f[o].y-=u.height/2+s||0;return new t.Polygon(f,r(c,u),!0)},t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){function i(n){return n[0]==="H"?n[1]:n[n.length-2]}function r(n){return n[0]==="V"?n[1]:n[n.length-1]}var s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var t=n.fabric||(n.fabric={}),f=t.util.array.min,e=t.util.array.max,u=t.util.object.extend,h=Object.prototype.toString,o=t.util.drawArc;if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",initialize:function(n,t){if(t=t||{},this.setOptions(t),!n)throw new Error("`path` argument is required");var i=h.call(n)==="[object Array]";(this.path=i?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path)&&(i||(this.path=this._parsePath()),this._initializePath(t),t.sourcePath&&this.setSourcePath(t.sourcePath))},_initializePath:function(n){var t="width"in n&&n.width!=null,i="height"in n&&n.width!=null,r="left"in n,f="top"in n,e=r?this.left:0,o=f?this.top:0;t&&i?(f||(this.top=this.height/2),r||(this.left=this.width/2)):(u(this,this._parseDimensions()),t&&(this.width=n.width),i&&(this.height=n.height)),this.pathOffset=this.pathOffset||this._calculatePathOffset(e,o)},_calculatePathOffset:function(n,t){return{x:this.left-n-this.width/2,y:this.top-t-this.height/2}},_render:function(n){for(var t,l=null,i=0,r=0,e=0,s=0,h,c,v,y,u=-(this.width/2+this.pathOffset.x),f=-(this.height/2+this.pathOffset.y),a=0,p=this.path.length;a<p;++a){t=this.path[a];switch(t[0]){case"l":i+=t[1],r+=t[2],n.lineTo(i+u,r+f);break;case"L":i=t[1],r=t[2],n.lineTo(i+u,r+f);break;case"h":i+=t[1],n.lineTo(i+u,r+f);break;case"H":i=t[1],n.lineTo(i+u,r+f);break;case"v":r+=t[1],n.lineTo(i+u,r+f);break;case"V":r=t[1],n.lineTo(i+u,r+f);break;case"m":i+=t[1],r+=t[2],n[l&&(l[0]==="m"||l[0]==="M")?"lineTo":"moveTo"](i+u,r+f);break;case"M":i=t[1],r=t[2],n[l&&(l[0]==="m"||l[0]==="M")?"lineTo":"moveTo"](i+u,r+f);break;case"c":h=i+t[5],c=r+t[6],e=i+t[3],s=r+t[4],n.bezierCurveTo(i+t[1]+u,r+t[2]+f,e+u,s+f,h+u,c+f),i=h,r=c;break;case"C":i=t[5],r=t[6],e=t[3],s=t[4],n.bezierCurveTo(t[1]+u,t[2]+f,e+u,s+f,i+u,r+f);break;case"s":h=i+t[3],c=r+t[4],e=e?2*i-e:i,s=s?2*r-s:r,n.bezierCurveTo(e+u,s+f,i+t[1]+u,r+t[2]+f,h+u,c+f),e=i+t[1],s=r+t[2],i=h,r=c;break;case"S":h=t[3],c=t[4],e=2*i-e,s=2*r-s,n.bezierCurveTo(e+u,s+f,t[1]+u,t[2]+f,h+u,c+f),i=h,r=c,e=t[1],s=t[2];break;case"q":h=i+t[3],c=r+t[4],e=i+t[1],s=r+t[2],n.quadraticCurveTo(e+u,s+f,h+u,c+f),i=h,r=c;break;case"Q":h=t[3],c=t[4],n.quadraticCurveTo(t[1]+u,t[2]+f,h+u,c+f),i=h,r=c,e=t[1],s=t[2];break;case"t":h=i+t[1],c=r+t[2],l[0].match(/[QqTt]/)===null?(e=i,s=r):l[0]==="t"?(e=2*i-v,s=2*r-y):l[0]==="q"&&(e=2*i-e,s=2*r-s),v=e,y=s,n.quadraticCurveTo(e+u,s+f,h+u,c+f),i=h,r=c,e=i+t[1],s=r+t[2];break;case"T":h=t[1],c=t[2],e=2*i-e,s=2*r-s,n.quadraticCurveTo(e+u,s+f,h+u,c+f),i=h,r=c;break;case"a":o(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+i+u,t[7]+r+f]),i+=t[6],r+=t[7];break;case"A":o(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+f]),i=t[6],r=t[7];break;case"z":case"Z":n.closePath()}l=t}},render:function(n,i){if(this.visible){n.save();var r=this.transformMatrix;r&&n.transform(r[0],r[1],r[2],r[3],r[4],r[5]),i||this.transform(n),this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n):this.fill),this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),n.beginPath(),this._render(n),this._renderFill(n),this._renderStroke(n),this.clipTo&&n.restore(),this._removeShadow(n),!i&&this.active&&(this.drawBorders(n),this.drawControls(n)),n.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(n){var t=u(this.callSuper("toObject",n),{path:this.path,pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),f,t=0,u=this.path.length;t<u;t++)r.push(this.path[t].join(" "));return f=r.join(" "),i.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","<\/g>"),n?n(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var e=[],i=[],o,h,w=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,c,l,n,u,v,y,f,t,p,r=0,a=this.path.length;r<a;r++){for(o=this.path[r],l=o.slice(1).trim(),i.length=0;c=w.exec(l);)i.push(c[0]);for(n=[o.charAt(0)],u=0,v=i.length;u<v;u++)h=parseFloat(i[u]),isNaN(h)||n.push(h);if(y=n[0].toLowerCase(),f=s[y],n.length-1>f)for(t=1,p=n.length;t<p;t+=f)e.push([n[0]].concat(n.slice(t,t+f)));else e.push(n)}return e},_parseDimensions:function(){var n=[],t=[],u,o,s=!1,h,c;this.path.forEach(function(f,e){f[0]!=="H"&&(u=e===0?i(f):i(this.path[e-1])),f[0]!=="V"&&(o=e===0?r(f):r(this.path[e-1])),f[0]===f[0].toLowerCase()&&(s=!0),h=s?u+i(f):f[0]==="V"?u:i(f),c=s?o+r(f):f[0]==="H"?o:r(f);var l=parseInt(h,10);isNaN(l)||n.push(l),l=parseInt(c,10),isNaN(l)||t.push(l)},this);var l=f(n),a=f(t),p=e(n),w=e(t),v=p-l,y=w-a;return{left:this.left+(l+v/2),top:this.top+(a+y/2),width:v,height:y}}}),t.Path.fromObject=function(n,i){typeof n.path=="string"?t.loadSVGFromURL(n.path,function(r){var u=r[0],f=n.path;delete n.path,t.util.object.extend(u,n),u.setSourcePath(f),i(u)}):i(new t.Path(n.path,n))},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(n,i,r){var f=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);i&&i(new t.Path(f.d,u(f,r)))},t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(n,t){t=t||{},this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(t),this.setCoords(),t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(n){var i,r,u;if(this.visible){for(n.save(),i=this.transformMatrix,i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),r=0,u=this.paths.length;r<u;++r)this.paths[r].render(n,!0);this.clipTo&&n.restore(),this._removeShadow(n),this.active&&(this.drawBorders(n),this.drawControls(n)),n.restore()}},_set:function(n,t){if(n==="fill"&&t&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(n,t);return this.callSuper("_set",n,t)},toObject:function(n){var t=i(u.call(this,n),{paths:r(this.getObjects(),"toObject",n)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(n){for(var r=this.getObjects(),t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],i=0,u=r.length;i<u;i++)t.push(r[i].toSVG(n));return t.push("<\/g>"),n?n(t.join("")):t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=this.getObjects()[0].get("fill");return this.getObjects().every(function(t){return t.get("fill")===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}}),t.PathGroup.fromObject=function(n,i){typeof n.paths=="string"?t.loadSVGFromURL(n.paths,function(r){var f=n.paths,u;delete n.paths,u=t.util.groupSVGElements(r,n,f),i(u)}):t.util.enlivenObjects(n.paths,function(r){delete n.paths,i(new t.PathGroup(r,n))})},t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,e=t.util.array.invoke,f;t.Group||(f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0},t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(n,t){t=t||{},this._objects=n||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),t&&i(this,t),this._setOpacityIfSame(),this.setCoords(!0),this.saveCoords()},_updateObjectsCoords:function(){var n=this.left,t=this.top;this.forEachObject(function(i){var r=i.get("left"),u=i.get("top");i.set("originalLeft",r),i.set("originalTop",u),i.set("left",r-n),i.set("top",u-t),i.setCoords(),i.__origHasControls=i.hasControls,i.hasControls=!1},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},addWithUpdate:function(n){return this._restoreObjectsState(),this._objects.push(n),n.group=this,this.forEachObject(function(n){n.set("active",!0),n.group=this},this),this._calcBounds(),this._updateObjectsCoords(),this},removeWithUpdate:function(n){return this._moveFlippedObject(n),this._restoreObjectsState(),this.forEachObject(function(n){n.set("active",!0),n.group=this},this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(n){n.group=this},_onObjectRemoved:function(n){delete n.group,n.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(n,t){if(n in this.delegatedProperties){var i=this._objects.length;for(this[n]=t;i--;)this._objects[i].set(n,t)}else this[n]=t},toObject:function(n){return i(this.callSuper("toObject",n),{objects:e(this._objects,"toObject",n)})},render:function(n,i){var f,u,e;if(this.visible){for(n.save(),this.transform(n),f=Math.max(this.scaleX,this.scaleY),this.clipTo&&t.util.clipContext(this,n),u=0,e=this._objects.length;u<e;u++){var r=this._objects[u],o=r.borderScaleFactor,s=r.hasRotatingPoint;r.visible&&(r.borderScaleFactor=f,r.hasRotatingPoint=!1,r.render(n),r.borderScaleFactor=o,r.hasRotatingPoint=s)}this.clipTo&&n.restore(),!i&&this.active&&(this.drawBorders(n),this.drawControls(n)),n.restore(),this.setCoords()}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(n){var i=n.get("originX"),r=n.get("originY"),u=n.getCenterPoint(),t;return n.set({originX:"center",originY:"center",left:u.x,top:u.y}),this.flipX&&(n.toggle("flipX"),n.set("left",-n.get("left")),n.setAngle(-n.getAngle())),this.flipY&&(n.toggle("flipY"),n.set("top",-n.get("top")),n.setAngle(-n.getAngle())),t=n.getPointByOrigin(i,r),n.set({originX:i,originY:r,left:t.x,top:t.y}),this},_restoreObjectState:function(n){var i=this.get("left"),r=this.get("top"),t=this.getAngle()*(Math.PI/180),u=Math.cos(t)*n.get("top")*this.get("scaleY")+Math.sin(t)*n.get("left")*this.get("scaleX"),f=-Math.sin(t)*n.get("top")*this.get("scaleY")+Math.cos(t)*n.get("left")*this.get("scaleX");return n.setAngle(n.getAngle()+this.getAngle()),n.set("left",i+f),n.set("top",r+u),n.set("scaleX",n.get("scaleX")*this.get("scaleX")),n.set("scaleY",n.get("scaleY")*this.get("scaleY")),n.setCoords(),n.hasControls=n.__origHasControls,delete n.__origHasControls,n.set("active",!1),n.setCoords(),delete n.group,this},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},_setOpacityIfSame:function(){var n=this.getObjects(),t=n[0]?n[0].get("opacity"):1,i=n.every(function(n){return n.get("opacity")===t});i&&(this.opacity=t)},_calcBounds:function(){for(var t=[],i=[],f,e,l,a,n,o,s,h=0,v=this._objects.length,c;h<v;++h){n=this._objects[h],n.setCoords();for(c in n.oCoords)t.push(n.oCoords[c].x),i.push(n.oCoords[c].y)}f=r(t),l=u(t),e=r(i),a=u(i),o=l-f||0,s=a-e||0,this.width=o,this.height=s,this.left=f+o/2||0,this.top=e+s/2||0},toSVG:function(n){for(var t=["<g ",'transform="',this.getSvgTransform(),'">'],i=0,r=this._objects.length;i<r;i++)t.push(this._objects[i].toSVG(n));return t.push("<\/g>"),n?n(t.join("")):t.join("")},get:function(n){if(n in f){if(this[n])return this[n];for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t][n])return!0;return!1}return n in this.delegatedProperties?this._objects[0]&&this._objects[0].get(n):this[n]}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects,i&&i(new t.Group(r,n))})},t.Group.async=!0)}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(n,t){t||(t={}),this.filters=[],this.callSuper("initialize",t),this._initElement(n),this._initConfig(t),t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n,t){return this._element=n,this._originalElement=n,this._initConfig(),this.filters.length!==0&&this.applyFilters(t),this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},render:function(n,t){if(this.visible){n.save();var i=this.transformMatrix,r=this.group&&this.group.type!=="group";r&&n.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2),i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t||this.transform(n),n.save(),this._setShadow(n),this.clipTo&&fabric.util.clipContext(this,n),this._render(n),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),this._renderStroke(n),this.clipTo&&n.restore(),n.restore(),this.active&&!t&&(this.drawBorders(n),this.drawControls(n)),n.restore()}},_stroke:function(n){n.save(),n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke,n.beginPath(),n.strokeRect(-this.width/2,-this.height/2,this.width,this.height),n.closePath(),n.restore()},_renderDashedStroke:function(n){var t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.save(),n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke,n.beginPath(),fabric.util.drawDashedLine(n,t,i,t+r,i,this.strokeDashArray),fabric.util.drawDashedLine(n,t+r,i,t+r,i+u,this.strokeDashArray),fabric.util.drawDashedLine(n,t+r,i+u,t,i+u,this.strokeDashArray),fabric.util.drawDashedLine(n,t,i+u,t,i,this.strokeDashArray),n.closePath(),n.restore()},toObject:function(n){return t(this.callSuper("toObject",n),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(n){return n&&n.toObject()})})},toSVG:function(n){var t=[],i;return t.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'"><\/image>'),(this.stroke||this.strokeDashArray)&&(i=this.fill,this.fill=null,t.push("<rect ",'x="',this.width/-2,'" y="',this.height/-2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=i),t.push("<\/g>"),n?n(t.join("")):t.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n,t){this.constructor.fromObject(this.toObject(t),n)},applyFilters:function(n){if(this.filters.length===0){this._element=this._originalElement,n&&n();return}var t=this._originalElement,r=fabric.util.createCanvasElement(),i=fabric.util.createImage(),u=this;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height),this.filters.forEach(function(n){n&&n.applyTo(r)}),i.width=t.width,i.height=t.height,fabric.isLikelyNode?(i.src=r.toBuffer(undefined,fabric.Image.pngCompression),u._element=i,n&&n()):(i.onload=function(){u._element=i,n&&n(),i.onload=r=t=null},i.src=r.toDataURL("image/png")),this},_render:function(n){n.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width),this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={}),this.setOptions(n),this._setWidthHeight(n)},_initFilters:function(n,t){n.filters&&n.filters.length?fabric.util.enlivenObjects(n.filters,function(n){t&&t(n)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(n){this.width="width"in n?n.width:this.getElement().width||0,this.height="height"in n?n.height:this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(n,t){var i=fabric.document.createElement("img"),r=n.src;i.onload=function(){fabric.Image.prototype._initFilters.call(n,n,function(r){n.filters=r||[];var u=new fabric.Image(i,n);t&&t(u),i=i.onload=i.onerror=null})},i.onerror=function(){fabric.log("Error loading "+i.src),t&&t(null,!0),i=i.onload=i.onerror=null},i.src=r},fabric.Image.fromURL=function(n,t,i){fabric.util.loadImage(n,function(n){t(new fabric.Image(n,i))})},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(n,i,r){var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(u["xlink:href"],i,t(r?fabric.util.object.clone(r):{},u))},fabric.Image.async=!0,fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.getAngle()%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n),u()},onComplete:function(){t.setCoords(),r()},onStart:function(){t.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(n){n=n||{},this.brightness=n.brightness||100},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,r=this.brightness,t=0,e=i.length;t<e;t+=4)i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),t.Image.filters.Brightness.fromObject=function(n){return new t.Image.filters.Brightness(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(n){n=n||{},this.opaque=n.opaque,this.matrix=n.matrix||[0,0,0,0,1,0,0,0,0];var i=t.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(n,t){return this.tmpCtx.createImageData(n,t)},applyTo:function(n){for(var b=this.matrix,k=n.getContext("2d"),v=k.getImageData(0,0,n.width,n.height),o=Math.round(Math.sqrt(b.length)),d=Math.floor(o/2),s=v.data,y=v.width,g=v.height,p=y,nt=g,tt=this._createImageData(p,nt),h=tt.data,ft=this.opaque?1:0,i,r,u,l,a,f,e,t=0;t<nt;t++)for(i=0;i<p;i++){var et=t,ot=i,c=(t*p+i)*4,it=0,rt=0,ut=0,w=0;for(r=0;r<o;r++)for(u=0;u<o;u++)l=et+r-d,a=ot+u-d,l>=0&&l<g&&a>=0&&a<y&&(f=(l*y+a)*4,e=b[r*o+u],it+=s[f]*e,rt+=s[f+1]*e,ut+=s[f+2]*e,w+=s[f+3]*e);h[c]=it,h[c+1]=rt,h[c+2]=ut,h[c+3]=w+ft*(255-w)}k.putImageData(tt,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=function(n){return new t.Image.filters.Convolute(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(n){n=n||{},this.threshold=n.threshold||100},applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,o=this.threshold,f=i.length,t=0,e=i.length;t<e;t+=4)i[t+3]=o+255*(f-t)/f;r.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),t.Image.filters.GradientTransparency.fromObject=function(n){return new t.Image.filters.GradientTransparency(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(n){for(var f=n.getContext("2d"),r=f.getImageData(0,0,n.width,n.height),i=r.data,e=r.width*r.height*4,t=0,u;t<e;)u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u,t+=4;f.putImageData(r,0,0)}}),t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)}}),t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(n){n=n||{},this.mask=n.mask,this.channel=[0,1,2,3].indexOf(n.channel)>-1?n.channel:0},applyTo:function(n){var o,s;if(this.mask){var e=n.getContext("2d"),u=e.getImageData(0,0,n.width,n.height),h=u.data,i=this.mask.getElement(),f=t.util.createCanvasElement(),c=this.channel,r,l=u.width*u.height*4;for(f.width=i.width,f.height=i.height,f.getContext("2d").drawImage(i,0,0,i.width,i.height),o=f.getContext("2d").getImageData(0,0,i.width,i.height),s=o.data,r=0;r<l;r+=4)h[r+3]=s[r+c];e.putImageData(u,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),t.Image.filters.Mask.fromObject=function(n,i){var r=t.document.createElement("img"),u=n.mask.src;r.onload=function(){n.mask=new t.Image(r,n.mask),i&&i(new t.Image.filters.Mask(n)),r=r.onload=r.onerror=null},r.onerror=function(){t.log("Error loading "+r.src),i&&i(null,!0),r=r.onload=r.onerror=null},r.src=u},t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(n){n=n||{},this.noise=n.noise||100},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,o=this.noise,r,t=0,e=i.length;t<e;t+=4)r=(.5-Math.random())*o,i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=function(n){return new t.Image.filters.Noise(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(n){n=n||{},this.blocksize=n.blocksize||4},applyTo:function(n){for(var h=n.getContext("2d"),f=h.getImageData(0,0,n.width,n.height),i=f.data,w=f.height,s=f.width,t,u,c,l,a,v,e,y,o,p,r=0;r<w;r+=this.blocksize)for(u=0;u<s;u+=this.blocksize)for(t=r*4*s+u*4,c=i[t],l=i[t+1],a=i[t+2],v=i[t+3],e=r,y=r+this.blocksize;e<y;e++)for(o=u,p=u+this.blocksize;o<p;o++)t=e*4*s+o*4,i[t]=c,i[t+1]=l,i[t+2]=a,i[t+3]=v;h.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),t.Image.filters.Pixelate.fromObject=function(n){return new t.Image.filters.Pixelate(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(n){n=n||{},this.threshold=n.threshold||30,this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,a=this.threshold,e=this.distance,o=255-a,s=Math.abs,r,u,f,t=0,l=i.length;t<l;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),t.Image.filters.RemoveWhite.fromObject=function(n){return new t.Image.filters.RemoveWhite(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=i.length,r,t=0;t<e;t+=4)r=.3*i[t]+.59*i[t+1]+.11*i[t+2],i[t]=r+100,i[t+1]=r+50,i[t+2]=r+255;u.putImageData(f,0,0)}}),t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(n){for(var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),i=o.data,s=i.length,r,u,f,t=0;t<s;t+=4)r=i[t],u=i[t+1],f=i[t+2],i[t]=(r*.393+u*.769+f*.189)/1.351,i[t+1]=(r*.349+u*.686+f*.168)/1.203,i[t+2]=(r*.272+u*.534+f*.131)/2.14;e.putImageData(o,0,0)}}),t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(n){n=n||{},this.color=n.color||"#000000",this.opacity=typeof n.opacity!="undefined"?n.opacity:new t.Color(this.color).getAlpha()},applyTo:function(n){var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),r=o.data,y=r.length,i,s,h,c,l,a,v,u,f;for(f=new t.Color(this.color).getSource(),s=f[0]*this.opacity,h=f[1]*this.opacity,c=f[2]*this.opacity,u=1-this.opacity,i=0;i<y;i+=4)l=r[i],a=r[i+1],v=r[i+2],r[i]=s+l*u,r[i+1]=h+a*u,r[i+2]=c+v*u;e.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),t.Image.filters.Tint.fromObject=function(n){return new t.Image.filters.Tint(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,f=t.util.object.clone,i=t.util.toFixed,e=t.StaticCanvas.supports("setLineDash"),r;if(t.Text){t.warn("fabric.Text is already defined");return}r=t.Object.prototype.stateProperties.concat(),r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:r,stroke:null,shadow:null,initialize:function(n,t){t=t||{},this.text=n,this.__skipDimension=!0,this.setOptions(t),this.__skipDimension=!1,this._initDimensions(),this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var n=t.util.createCanvasElement();this._render(n.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){var t=this.group&&this.group.type!=="group";t&&!this.transformMatrix?n.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):t&&this.transformMatrix&&n.translate(-this.group.width/2,-this.group.height/2),typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(n):this._renderViaCufon(n)},_renderViaNative:function(n){this.transform(n,t.isLikelyNode),this._setTextStyles(n);var i=this.text.split(/\r?\n/);this.width=this._getTextWidth(n,i),this.height=this._getTextHeight(n,i),this.clipTo&&t.util.clipContext(this,n),this._renderTextBackground(n,i),this.textAlign!=="left"&&this.textAlign!=="justify"&&(n.save(),n.translate(this.textAlign==="center"?this.width/2:this.width,0)),n.save(),this._setShadow(n),this._renderTextFill(n,i),this._renderTextStroke(n,i),this._removeShadow(n),n.restore(),this.textAlign!=="left"&&this.textAlign!=="justify"&&n.restore(),this._renderTextDecoration(n,i),this.clipTo&&n.restore(),this._setBoundaries(n,i),this._totalLineHeight=0},_setBoundaries:function(n,t){var i,u,r,f;for(this._boundaries=[],i=0,u=t.length;i<u;i++)r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),this._boundaries.push({height:this.fontSize*this.lineHeight,width:r,left:f})},_setTextStyles:function(n){this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n):this.fill),this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke),n.textBaseline="alphabetic",this.skipTextAlign||(n.textAlign=this.textAlign),n.font=this._getFontDeclaration()},_getTextHeight:function(n,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(n,t){for(var r=n.measureText(t[0]).width,u,i=1,f=t.length;i<f;i++)u=n.measureText(t[i]).width,u>r&&(r=u);return r},_drawChars:function(n,t,i,r,u){t[n](i,r,u)},_drawTextLine:function(n,t,i,r,u,f){var h,s,e,l;if(u-=this.fontSize/4,this.textAlign!=="justify"){this._drawChars(n,t,i,r,u,f);return}if(h=t.measureText(i).width,s=this.width,s>h){var o=i.split(/\s+/),a=t.measureText(i.replace(/\s+/g,"")).width,v=s-a,y=o.length-1,p=v/y,c=0;for(e=0,l=o.length;e<l;e++)this._drawChars(n,t,o[e],r+c,u,f),c+=t.measureText(o[e]).width+p}else this._drawChars(n,t,i,r,u,f)},_getLeftOffset:function(){return t.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(n,t){var r,i,u,f;if(this.fill||this.skipFillStrokeCheck)for(this._boundaries=[],r=0,i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._drawTextLine("fillText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i)},_renderTextStroke:function(n,t){var r,i,u,f;if(this.stroke||this.skipFillStrokeCheck){for(r=0,n.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&n.setLineDash(this.strokeDashArray)),n.beginPath(),i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._drawTextLine("strokeText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i);n.closePath(),n.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(n,t){this._renderTextBoxBackground(n),this._renderTextLinesBackground(n,t)},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},_renderTextLinesBackground:function(n,t){var i,u,r,f;if(this.textBackgroundColor){for(n.save(),n.fillStyle=this.textBackgroundColor,i=0,u=t.length;i<u;i++)t[i]!==""&&(r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+i*this.fontSize*this.lineHeight,r,this.fontSize*this.lineHeight));n.restore()}},_getLineLeftOffset:function(n){return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:0},_getLineWidth:function(n,t){return this.textAlign==="justify"?this.width:n.measureText(t).width},_renderTextDecoration:function(n,t){function r(r){for(var e,s,f=0,o=t.length;f<o;f++)e=i._getLineWidth(n,t[f]),s=i._getLineLeftOffset(e),n.fillRect(i._getLeftOffset()+s,~~(r+f*i._getHeightOfLine(n,f,t)-u),e,1)}if(this.textDecoration){var u=this._getTextHeight(n,t)/2,i=this;this.textDecoration.indexOf("underline")>-1&&r(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&r(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&r(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(n,t){this.visible&&(n.save(),this._render(n),!t&&this.active&&(this.drawBorders(n),this.drawControls(n)),n.restore())},toObject:function(n){var t=u(this.callSuper("toObject",n),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=[],r=this.text.split(/\r?\n/),u=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,f=-(this.width/2),e=this.useNative?this.fontSize-1:this.height/2-r.length*this.fontSize-this._totalLineHeight,o=this._getSVGTextAndBg(u,f,r),s=this._getSVGShadows(u,r);return e+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,t.push('<g transform="',this.getSvgTransform(),'">',o.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(f,2)," ",i(e,2),')">',s.join(""),o.textSpans.join(""),"<\/text>","<\/g>"),n?n(t.join("")):t.join("")},_getSVGShadows:function(n,r){var f=[],u,o,e=1,s;if(!this.shadow||!this._boundaries)return f;for(u=0,o=r.length;u<o;u++)r[u]!==""?(s=this._boundaries&&this._boundaries[u]?this._boundaries[u].left:0,f.push('<tspan x="',i(s+e+this.shadow.offsetX,2),u===0||this.useNative?'" y':'" dy','="',i(this.useNative?n*u-this.height/2+this.shadow.offsetY:n+(u===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",t.util.string.escapeXml(r[u]),"<\/tspan>"),e=1):e++;return f},_getSVGTextAndBg:function(n,r,u){var s=[],e=[],f,h,c,o=1;for(this.backgroundColor&&this._boundaries&&e.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"><\/rect>'),f=0,c=u.length;f<c;f++)(u[f]!==""?(h=this._boundaries&&this._boundaries[f]?i(this._boundaries[f].left,2):0,s.push('<tspan x="',h,'" ',f===0||this.useNative?"y":"dy",'="',i(this.useNative?n*f-this.height/2:n*o,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(u[f]),"<\/tspan>"),o=1):o++,this.textBackgroundColor&&this._boundaries)&&e.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(r+this._boundaries[f].left,2),'" y="',i(n*f-this.height/2,2),'" width="',i(this._boundaries[f].width,2),'" height="',i(this._boundaries[f].height,2),'"><\/rect>');return{textSpans:s,textBgRects:e}},_getFillAttributes:function(n){var i=n&&typeof n=="string"?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(n,t){n==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3")),this.callSuper("_set",n,t),n in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),t.Text.fromElement=function(n,i){var u,r;return n?(u=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES),i=t.util.object.extend(i?t.util.object.clone(i):{},u),r=new t.Text(n.textContent,i),r.set({left:r.getLeft()+r.getWidth()/2,top:r.getTop()-r.getHeight()/2}),r):null},t.Text.fromObject=function(n){return new t.Text(n.text,f(n))},t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(n){var t=Cufon.textOptions||(Cufon.textOptions={}),i;t.left=this.left,t.top=this.top,t.context=n,t.color=this.fill,i=this._initDummyElementForCufon(),this.transform(n),Cufon.replaceElement(i,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor}),this.width=t.width,this.height=t.height,this._totalLineHeight=t.totalLineHeight,this._fontAscent=t.fontAscent,this._boundaries=t.boundaries,i=null,this.setCoords()},_initDummyElementForCufon:function(){var n=fabric.document.createElement("pre"),t=fabric.document.createElement("div");return t.appendChild(n),typeof G_vmlCanvasManager=="undefined"?n.innerHTML=this.text:n.innerText=this.text.replace(/\r?\n/gi,"\r"),n.style.fontSize=this.fontSize+"px",n.style.letterSpacing="normal",n}}),function(){function n(n,t,i){var r=e.parse(n),f,u;r.port||(r.port=r.protocol.indexOf("https:")===0?443:80),f=r.port===443?s:o,u=f.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode===200&&(r+=t)})});u.on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(n.message)});u.end()}function i(n,t){var i=require("fs");i.readFile(n,function(n,i){if(n){fabric.log(n);throw n;}else t(i)})}var r,u;if(typeof document=="undefined"||typeof window=="undefined"){var f=new require("xmldom").DOMParser,e=require("url"),o=require("http"),s=require("https"),t=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(t,r,u){var e=function(n){f.src=new Buffer(n,"binary"),f._src=t,r&&r.call(u,f)},f=new h;t&&(t instanceof Buffer||t.indexOf("data")===0)?(f.src=f._src=t,r&&r.call(u,f)):t&&t.indexOf("http")!==0?i(t,e):t&&n(t,"binary",e)},fabric.loadSVGFromURL=function(t,r,u){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),t.indexOf("http")!==0?i(t,function(n){fabric.loadSVGFromString(n,r,u)}):n(t,"",function(n){fabric.loadSVGFromString(n,r,u)})},fabric.loadSVGFromString=function(n,t,i){var r=(new f).parseFromString(n);fabric.parseSVGDocument(r.documentElement,function(n,i){t&&t(n,i)},i)},fabric.util.getScript=function(t,i){n(t,"",function(body){eval(body),i&&i()})},fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n),r._initFilters(n,function(n){r.filters=n||[],t&&t(r)})})},fabric.createCanvasForNode=function(n,i){var u=fabric.document.createElement("canvas"),f=new t(n||600,i||600),e,r;return u.style={},u.width=f.width,u.height=f.height,e=fabric.Canvas||fabric.StaticCanvas,r=new e(u),r.contextContainer=f.getContext("2d"),r.nodeCanvas=f,r.Font=t.Font,r},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(n){return this.nodeCanvas.createJPEGStream(n)},r=fabric.StaticCanvas.prototype.setWidth,fabric.StaticCanvas.prototype.setWidth=function(n){return r.call(this,n),this.nodeCanvas.width=n,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth),u=fabric.StaticCanvas.prototype.setHeight,fabric.StaticCanvas.prototype.setHeight=function(n){return u.call(this,n),this.nodeCanvas.height=n,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();
