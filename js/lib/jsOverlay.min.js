(function(n){var t=[],i=[];n.fn.popup=n.fn.popup=function(r){var y=n("body"),p=n(window),k=n(document),f,e,o,u={},h,c,w={type:"overlay",action:"click",background:!0,color:"black",opacity:"0.4",horizontal:"center",vertical:"center",escape:!0,blur:!0,fade:250,opensufix:"_open",closesufix:"_close",keepfocus:!0,reposition:!1,autozindex:!1},b=function(h){var c,k,p,v;if(n(h).attr("id")||n(h).attr("id","j-popup-"+parseInt(Math.random()*1e8)),i[h.id]=!1,t[h.id]=0,f=n(h),u=n.extend({},w,r),u.reposition===!0)return e=f,f=o=n("#"+h.id+"_wrapper"),a(h),!1;if(f.attr("data-popup-initialized"))return!1;if(f.attr("data-popup-initialized","true"),c="."+h.id+u.opensufix,u.type=="tooltip"&&(u.background=!1,u.keepfocus=!1),f.css({display:"none"}),y.prepend(h),u.background&&!n("#"+h.id+"_background").length&&(k='<div id="'+h.id+'_background" class="popup_background"><\/div>',y.prepend(k),n("#"+h.id+"_background").css({backgroundColor:u.color,opacity:u.opacity,position:"fixed",top:"0",right:"0",bottom:"0",left:"0",display:"none"})),u.type=="overlay"&&(f.css({display:"inline-block",textAlign:"left",position:"relative",verticalAlign:"middle"}).addClass("popup_content"),f.wrap('<div id="'+h.id+'_wrapper" class="popup_wrapper" />'),o=n("#"+h.id+"_wrapper"),o.css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none",textAlign:"center"}),o.append('<div class="popup_align" />'),n(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"}),u.horizontal=="right"?o.css("text-align","right"):u.horizontal=="left"&&o.css("text-align","left"),u.vertical=="bottom"?f.css("vertical-align","bottom"):u.vertical=="top"&&f.css("vertical-align","top"),e=f,f=o),n(c).each(function(t,i){n(i).attr("data-popup-order",t)}),u.action=="click"?(n(c).live("click",function(t){if(f.is(":hidden")){var i=n(this).attr("data-popup-order");l(h,i),t.preventDefault()}}),n("."+h.id+u.closesufix).click(function(n){s(h),n.preventDefault()})):u.action=="hover"?(n(c).mouseenter(function(){l(h,n(this).attr("data-popup-order"))}),n(c).mouseleave(function(){s(h)})):(n(c).mouseover(function(){l(h,n(this).attr("data-popup-order"))}),n(c).mouseout(function(){s(h)})),u.escape&&n(document).keydown(function(n){n.keyCode==27&&f.css("display")=="block"&&s(h)}),n(window).bind("resize",function(){u.type!="tooltip"&&a(h)}),u.autozindex===!0){var d=document.getElementsByTagName("*"),g=d.length,b=0;for(p=0;p<g;p++)v=n(d[p]).css("z-index"),v!=="auto"&&(v=parseInt(v),b<v&&(b=v));t[h.id]=b,t[h.id]>0&&f.css({zIndex:t[h.id]+2}),u.background&&t[h.id]>0&&n("#"+h.id+"_background").css({zIndex:t[h.id]+1})}u.autoopen&&l(h,0)},l=function(t,r){var o=r;v(u.beforeopen,o),i[t.id]=o,u.fade?f.fadeIn(u.fade,function(){n(document).on("click",h);n(document).on("focusin",c)}):(f.show(),setTimeout(function(){n(document).on("click",h);n(document).on("focusin",c)},0)),a(t,o),u.background&&(u.fade?n("#"+t.id+"_background").fadeIn(u.fade):n("#"+t.id+"_background").show()),u.keepfocus&&(e.attr("tabindex",-1).focus(),c=function(i){n(i.target).parents().andSelf().is("#"+t.id)||e.focus()}),v(u.onOpen,o),u.blur&&(h=function(i){n(i.target).parents().andSelf().is("#"+t.id)||s(t)})},a=function(t,i){if(i=i||0,u.type=="tooltip"){f.css({position:"absolute"});var o=n("."+t.id+u.opensufix+'[data-popup-order="'+i+'"]'),r=o.offset();u.horizontal=="right"?f.css("left",r.left+o.outerWidth()):u.horizontal=="left"?f.css("right",n(window).width()-r.left):f.css("left",r.left+o.outerWidth()/2-n(t).outerWidth()/2-parseFloat(n(t).css("marginLeft"))),u.vertical=="bottom"?f.css("top",r.top+o.outerHeight()):u.vertical=="top"?f.css("bottom",n(window).height()-r.top):f.css("top",r.top+o.outerHeight()/2-n(t).outerHeight()/2-parseFloat(n(t).css("marginTop")))}else u.type=="overlay"&&(p.height()<e.outerHeight()+parseFloat(e.css("marginTop"))+parseFloat(e.css("marginBottom"))?f.css({position:"absolute",top:p.scrollTop()}):f.css({position:"fixed",top:"0"}))},s=function(t){u.background&&(u.fade?n("#"+t.id+"_background").fadeOut(u.fade):n("#"+t.id+"_background").hide()),u.blur&&n(document).off("click",h),u.keepfocus&&(n(document).off("focusin",c),n("."+t.id+u.opensufix).focus()),u.fade?f.fadeOut(u.fade):f.hide(),v(u.onClose,i[t.id])},v=function(t,i){var r=n("."+f.attr("id")+u.opensufix+'[data-popup-order="'+i+'"]');typeof t=="function"&&t(r)};return this.each(function(){b(this)}),s}})(jQuery);
